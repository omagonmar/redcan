

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>drizzlepac.util &mdash; DrizzlePac 2.2.6 (2018-11-02 15:37:13 -0400) documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/stsci.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/stsci.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="DrizzlePac 2.2.6 (2018-11-02 15:37:13 -0400) documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="../../index.html" class="icon icon-home"> DrizzlePac
            
            <img src="../../_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
              <div class="version">
                2.2.6
              </div>
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../astrodrizzle.html">Primary User Interface: AstroDrizzle()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../imageobject.html">imageObject Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process.html">Step 1: Process Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../static.html">Step 2: Generate a Static Mask</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sky.html">Step 3: Subtracting the Sky</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../adrizzle.html">Step 4 and 8: Drizzling the Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../median.html">Step 5: Create a Median Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ablot.html">Step 6: Blotting the Median Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drizcr.html">Step 7: Cosmic-ray identification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../util.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tweakback.html">Tweakback</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LICENSE.html">LICENSE</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG.html">DrizzlePac Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tweakreg.html">TWEAKREG: Alignment of Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../refimagefindpars.html">Refmagefindpars: Source finding parameters for the reference image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../imagefindpars.html">Imagefindpars: Source finding parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../image.html">Image Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../catalogs.html">Classes to manage Catalogs and WCSâ€™s</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wcscorr.html">Functions to Manage WCS Table Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wcscorr.html#functions-to-manage-legacy-opus-wcs-keywords-in-the-wcs-table">Functions to Manage Legacy OPUS WCS Keywords in the WCS Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tweakutils.html">TWEAKUTILS: Utility Functions for Tweakreg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../updatehdr.html">UPDATEHDR: Functions for Updating WCS with New Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mapreg.html">Region mapping for TweakReg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../photeq.html">Photometric equalization for AstroDrizzle</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pixtopix.html">pixtopix: Coordinate transformation to/from drizzled images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pixtosky.html">pixtosky: Coordinate transformation to sky coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../skytopix.html">skytopix: Coordinate transformation from sky coordinates</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../updatenpol.html">Updatenpol</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../runastrodriz.html">Running Astrodriz</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">DrizzlePac</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>drizzlepac.util</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for drizzlepac.util</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A library of utility functions</span>

<span class="sd">:Authors: Warren Hack</span>

<span class="sd">:License: :doc:`LICENSE`</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span> <span class="c1"># confidence medium</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">errno</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy</span>

<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">stsci.tools</span> <span class="k">import</span> <span class="n">asnutil</span><span class="p">,</span> <span class="n">fileutil</span><span class="p">,</span> <span class="n">teal</span><span class="p">,</span> <span class="n">cfgpars</span><span class="p">,</span> <span class="n">logutil</span>
<span class="kn">from</span> <span class="nn">stsci.tools</span> <span class="k">import</span> <span class="n">check_files</span>
<span class="kn">from</span> <span class="nn">stsci.tools</span> <span class="k">import</span> <span class="n">configobj</span>

<span class="kn">from</span> <span class="nn">stwcs</span> <span class="k">import</span> <span class="n">wcsutil</span>
<span class="kn">from</span> <span class="nn">stwcs.wcsutil</span> <span class="k">import</span> <span class="n">altwcs</span>

<span class="kn">from</span> <span class="nn">.version</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">__fits_version__</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">__version__</span>
<span class="n">__numpy_version__</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">__version__</span>


<span class="n">multiprocessing</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">can_parallel</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">_cpu_count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">if</span> <span class="s1">&#39;ASTRODRIZ_NO_PARALLEL&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">multiprocessing</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># sanity check - do we even have the hardware?</span>
            <span class="n">_cpu_count</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
            <span class="n">can_parallel</span> <span class="o">=</span> <span class="n">_cpu_count</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">can_parallel</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Could not import multiprocessing, will only take advantage of a single CPU core&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="get_pool_size"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.get_pool_size">[docs]</a><span class="k">def</span> <span class="nf">get_pool_size</span><span class="p">(</span><span class="n">usr_config_value</span><span class="p">,</span> <span class="n">num_tasks</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Determine size of thread/process-pool for parallel processing.</span>
<span class="sd">    This examines the cpu_count to decide and return the right pool</span>
<span class="sd">    size to use.  Also take into account the user&#39;s wishes via the config</span>
<span class="sd">    object value, if specified.  On top of that, don&#39;t allow the pool size</span>
<span class="sd">    returned to be any higher than the number of parallel tasks, if specified.</span>
<span class="sd">    Only use what we need (mp.Pool starts pool_size processes, needed or not).</span>
<span class="sd">    If number of tasks is unknown, call this with &quot;num_tasks&quot; set to None.</span>
<span class="sd">    Returns 1 when indicating that parallel processing should not be used.</span>
<span class="sd">    Consolidate all such logic here, not in the caller. &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">can_parallel</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="c1"># Give priority to their specified cfg value, over the actual cpu count</span>
    <span class="k">if</span> <span class="n">usr_config_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">num_tasks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">usr_config_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># usr_config_value may be needlessly high</span>
            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">usr_config_value</span><span class="p">,</span> <span class="n">num_tasks</span><span class="p">)</span>
    <span class="c1"># they haven&#39;t specified a cfg value, so go with the cpu_count</span>
    <span class="k">if</span> <span class="n">num_tasks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_cpu_count</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># run no more workers than tasks</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">_cpu_count</span><span class="p">,</span> <span class="n">num_tasks</span><span class="p">)</span></div>


<span class="n">DEFAULT_LOGNAME</span> <span class="o">=</span> <span class="s1">&#39;astrodrizzle.log&#39;</span>
<span class="n">blank_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s2">&quot;None&quot;</span><span class="p">,</span><span class="s2">&quot;INDEF&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="is_blank"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.is_blank">[docs]</a><span class="k">def</span> <span class="nf">is_blank</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Determines whether or not a value is considered &#39;blank&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">blank_list</span></div>

<div class="viewcode-block" id="check_blank"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.check_blank">[docs]</a><span class="k">def</span> <span class="nf">check_blank</span><span class="p">(</span><span class="n">cvar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts blank value (from configObj?) into a value of None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cvar</span> <span class="ow">in</span> <span class="n">blank_list</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="n">cvar</span>
    <span class="k">return</span> <span class="n">val</span></div>

<span class="c1">#</span>
<span class="c1"># Logging routines</span>
<span class="c1">#</span>

<span class="n">_log_file_handler</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="init_logging"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.init_logging">[docs]</a><span class="k">def</span> <span class="nf">init_logging</span><span class="p">(</span><span class="n">logfile</span><span class="o">=</span><span class="n">DEFAULT_LOGNAME</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up logger for capturing stdout/stderr messages.</span>

<span class="sd">    Must be called prior to writing any messages that you want to log.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">logfile</span> <span class="o">==</span> <span class="s2">&quot;INDEF&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_blank</span><span class="p">(</span><span class="n">default</span><span class="p">):</span>
            <span class="n">logname</span> <span class="o">=</span> <span class="n">fileutil</span><span class="o">.</span><span class="n">buildNewRootname</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="s1">&#39;.log&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logname</span> <span class="o">=</span> <span class="n">DEFAULT_LOGNAME</span>
    <span class="k">elif</span> <span class="n">logfile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">logfile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.log&#39;</span><span class="p">):</span>
            <span class="n">logname</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logname</span> <span class="o">=</span> <span class="n">logfile</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logname</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">logname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logutil</span><span class="o">.</span><span class="n">setup_global_logging</span><span class="p">()</span>
        <span class="c1"># Don&#39;t use logging.basicConfig since it can only be called once in a</span>
        <span class="c1"># session</span>
        <span class="c1"># TODO: Would be fine to use logging.config.dictConfig, but it&#39;s not</span>
        <span class="c1"># available in Python 2.5</span>
        <span class="k">global</span> <span class="n">_log_file_handler</span>
        <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">_log_file_handler</span><span class="p">:</span>
            <span class="n">root_logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">_log_file_handler</span><span class="p">)</span>
        <span class="c1"># Default mode is &#39;a&#39; which is fine</span>
        <span class="n">_log_file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">logname</span><span class="p">)</span>
        <span class="c1"># TODO: Make the default level configurable in the task parameters</span>
        <span class="n">_log_file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="n">_log_file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">%(levelname)-8s</span><span class="s1">] </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="n">root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="n">root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">_log_file_handler</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting up logfile : &#39;</span><span class="p">,</span> <span class="n">logname</span><span class="p">)</span>

        <span class="c1">#stdout_logger = logging.getLogger(&#39;stsci.tools.logutil.stdout&#39;)</span>
        <span class="c1"># Disable display of prints to stdout from all packages except</span>
        <span class="c1"># drizzlepac</span>
        <span class="c1">#stdout_logger.addFilter(logutil.EchoFilter(include=[&#39;drizzlepac&#39;]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No trailer file created...&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="end_logging"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.end_logging">[docs]</a><span class="k">def</span> <span class="nf">end_logging</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Close log file and restore system defaults.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">logutil</span><span class="o">.</span><span class="n">global_logging_started</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trailer file written to: &#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This generally shouldn&#39;t happen if logging was started with</span>
            <span class="c1"># init_logging and a filename was given...</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No trailer file saved...&#39;</span><span class="p">)</span>

        <span class="n">logutil</span><span class="o">.</span><span class="n">teardown_global_logging</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No trailer file saved...&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="WithLogging"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.WithLogging">[docs]</a><span class="k">class</span> <span class="nc">WithLogging</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.processInput</span> <span class="k">import</span> <span class="n">processFilenames</span>

            <span class="n">errorobj</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Setup logging for this task; otherwise we&#39;re being called as</span>
                <span class="c1"># a subtask and will use the existing log</span>
                <span class="c1"># The first arg must be the configobj</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">configobj</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="nb">input</span> <span class="o">=</span> <span class="n">processFilenames</span><span class="p">(</span><span class="n">configobj</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">])</span>
                    <span class="n">inputs</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">input</span>
                    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">default</span> <span class="o">=</span> <span class="n">output</span>
                    <span class="k">elif</span> <span class="n">inputs</span><span class="p">:</span>
                        <span class="n">default</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># astrodrizzle and tweakreg have this parameter.</span>
                        <span class="c1"># Could we do away with it altogether?</span>
                        <span class="k">if</span> <span class="s1">&#39;runfile&#39;</span> <span class="ow">in</span> <span class="n">configobj</span><span class="p">:</span>
                            <span class="n">filename</span> <span class="o">=</span> <span class="n">configobj</span><span class="p">[</span><span class="s1">&#39;runfile&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">filename</span> <span class="o">=</span> <span class="n">default</span>
                    <span class="n">verbose_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
                    <span class="k">if</span> <span class="s1">&#39;verbose&#39;</span> <span class="ow">in</span> <span class="n">configobj</span> <span class="ow">and</span> <span class="n">configobj</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]:</span>
                        <span class="n">verbose_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
                    <span class="n">init_logging</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">verbose_level</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                    <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># This looks utterly bizarre, but it seems to be the only way I can</span>
            <span class="c1"># ensure that any exceptions that occur in the wrapped function are</span>
            <span class="c1"># logged before teardown_global_logging() is called.  Unless the</span>
            <span class="c1"># except clause is explicitly included here, even with just &#39;pass&#39;</span>
            <span class="c1"># under it, Python discards the sys.exc_info() data by the time the</span>
            <span class="c1"># finally clause is reached.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">errorobj</span> <span class="o">=</span> <span class="n">e</span>
                <span class="k">raise</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">end_logging</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="c1"># Insure that any exception raised by the code gets passed on</span>
                    <span class="c1"># (hope that end_logging didn&#39;t change the last exception raised)</span>
                    <span class="k">if</span> <span class="n">errorobj</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">errorobj</span>

        <span class="k">return</span> <span class="n">wrapper</span></div>


<span class="n">with_logging</span> <span class="o">=</span> <span class="n">WithLogging</span><span class="p">()</span>


<div class="viewcode-block" id="print_pkg_versions"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.print_pkg_versions">[docs]</a><span class="k">def</span> <span class="nf">print_pkg_versions</span><span class="p">(</span><span class="n">packages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">git</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">svn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">log</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">pkgs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="s1">&#39;astropy&#39;</span><span class="p">,</span> <span class="s1">&#39;stwcs&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">packages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">packages</span> <span class="o">=</span> <span class="p">[</span><span class="n">packages</span><span class="p">]</span>
        <span class="n">pkgs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>

    <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Version Information&#39;</span><span class="p">)</span>
    <span class="n">output</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">sysver</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Python Version </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sysver</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">ver</span> <span class="ow">in</span> <span class="n">sysver</span><span class="p">:</span>
        <span class="n">output</span><span class="p">(</span><span class="n">ver</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">software</span> <span class="ow">in</span> <span class="n">pkgs</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">package</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">software</span><span class="p">)</span>
            <span class="n">vstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">software</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vstr</span><span class="o">+=</span> <span class="s2">&quot;Version -&gt; &quot;</span><span class="o">+</span><span class="n">package</span><span class="o">.</span><span class="n">__version__</span><span class="o">+</span><span class="s2">&quot; &quot;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">vstr</span> <span class="o">+=</span> <span class="s2">&quot;No version defined.  &quot;</span>
            <span class="k">if</span> <span class="n">svn</span><span class="p">:</span>
                <span class="n">git</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1">#try:</span>
                <span class="c1">#    vstr += &quot;\n    SVN version -&gt; &quot;+package.__svn_version__.rstrip()</span>
                <span class="c1">#except:</span>
                <span class="c1">#    vstr += &quot; &quot;</span>
            <span class="k">if</span> <span class="n">git</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    GIT version -&gt; &quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">package</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="n">package</span><span class="o">.</span><span class="n">__version_post__</span><span class="p">,</span> <span class="n">package</span><span class="o">.</span><span class="n">__version_commit</span><span class="p">])</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">vstr</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">vstr</span> <span class="o">=</span> <span class="n">software</span><span class="o">+</span><span class="s2">&quot; not found in path...&quot;</span>
        <span class="n">output</span><span class="p">(</span><span class="n">vstr</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProcSteps"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.ProcSteps">[docs]</a><span class="k">class</span> <span class="nc">ProcSteps</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class allows MultiDrizzle to keep track of the</span>
<span class="sd">        start and end times of each processing step that gets run</span>
<span class="sd">        as well as computing/reporting the elapsed time for each step.</span>

<span class="sd">        The code for each processing step must call the &#39;addStep()&#39;</span>
<span class="sd">        method to initialize the information for that step, then</span>
<span class="sd">        the &#39;endStep()&#39; method to record the end and elapsed times.</span>

<span class="sd">        The &#39;reportTimes()&#39; method can then be used to provide a summary</span>
<span class="sd">        of all the elapsed times and total run time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__report_header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   </span><span class="si">%20s</span><span class="s1">          </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">__report_header</span> <span class="o">+=</span> <span class="s1">&#39;   </span><span class="si">%20s</span><span class="s1">          </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;Step&#39;</span><span class="p">,</span><span class="s1">&#39;Elapsed time&#39;</span><span class="p">)</span>
    <span class="n">__report_header</span> <span class="o">+=</span> <span class="s1">&#39;   </span><span class="si">%20s</span><span class="s1">          </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">_ptime</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="ProcSteps.addStep"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.ProcSteps.addStep">[docs]</a>    <span class="k">def</span> <span class="nf">addStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add information about a new step to the dict of steps</span>
<span class="sd">        The value &#39;ptime&#39; is the output from &#39;_ptime()&#39; containing</span>
<span class="sd">        both the formatted and unformatted time for the start of the</span>
<span class="sd">        step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ptime</span> <span class="o">=</span> <span class="n">_ptime</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==== Processing Step &#39;</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39; started at &#39;</span><span class="p">,</span><span class="n">ptime</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span><span class="n">ptime</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcSteps.endStep"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.ProcSteps.endStep">[docs]</a>    <span class="k">def</span> <span class="nf">endStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Record the end time for the step.</span>

<span class="sd">        If key==None, simply record ptime as end time for class to represent</span>
<span class="sd">        the overall runtime since the initialization of the class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ptime</span> <span class="o">=</span> <span class="n">_ptime</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;elapsed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;start&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">ptime</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==== Processing Step &#39;</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39; finished at &#39;</span><span class="p">,</span><span class="n">ptime</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcSteps.reportTimes"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.ProcSteps.reportTimes">[docs]</a>    <span class="k">def</span> <span class="nf">reportTimes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print out a formatted summary of the elapsed times for all the</span>
<span class="sd">        performed steps.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">_ptime</span><span class="p">()</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ProcSteps</span><span class="o">.</span><span class="n">__report_header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;elapsed&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step</span><span class="p">]:</span>
                <span class="n">_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step</span><span class="p">][</span><span class="s1">&#39;elapsed&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_time</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">total_time</span> <span class="o">+=</span> <span class="n">_time</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   </span><span class="si">%20s</span><span class="s1">          </span><span class="si">%0.4f</span><span class="s1"> sec.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">_time</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   </span><span class="si">%20s</span><span class="s1">          </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   </span><span class="si">%20s</span><span class="s1">          </span><span class="si">%0.4f</span><span class="s1"> sec.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="n">total_time</span><span class="p">))</span></div></div>

        <span class="c1"># Compute overall runtime of entire program, including overhead</span>
        <span class="c1">#total = self.end[1] - self.start[1]</span>
        <span class="c1">#print &#39;   %20s          %0.4f sec.&#39;%(&#39;Total Runtime&#39;,total)</span>


<span class="k">def</span> <span class="nf">_ptime</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dtime</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">dtime</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ftime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">dtime</span><span class="p">:</span>
        <span class="c1"># This time stamp includes sub-second timing...</span>
        <span class="n">_ltime</span> <span class="o">=</span> <span class="n">dtime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">ftime</span><span class="p">)</span>
        <span class="n">tlm_str</span> <span class="o">=</span> <span class="n">_ltime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">_ltime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mf">1e+6</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">_ltime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot; (</span><span class="si">%d</span><span class="s2">/%m/%Y)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Basic time stamp which only includes integer seconds</span>
        <span class="c1"># Format time values for keywords IRAF-TLM, and DATE</span>
        <span class="n">_ltime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">ftime</span><span class="p">)</span>
        <span class="n">tlm_str</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S (</span><span class="si">%d</span><span class="s1">/%m/%Y)&#39;</span><span class="p">,</span><span class="n">_ltime</span><span class="p">)</span>
        <span class="c1">#date_str = time.strftime(&#39;%Y-%m-%dT%H:%M:%S&#39;,_ltime)</span>
    <span class="k">return</span> <span class="n">tlm_str</span><span class="p">,</span><span class="n">ftime</span>


<div class="viewcode-block" id="findrootname"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.findrootname">[docs]</a><span class="k">def</span> <span class="nf">findrootname</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the rootname of the given file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">puncloc</span> <span class="o">=</span> <span class="p">[</span><span class="n">filename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">puncloc</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">!=-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="n">val</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">num</span>
    <span class="k">return</span> <span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">val</span><span class="p">]</span></div>


<div class="viewcode-block" id="removeFileSafely"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.removeFileSafely">[docs]</a><span class="k">def</span> <span class="nf">removeFileSafely</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Delete the file specified, but only if it exists and clobber is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">clobber</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="displayEmptyInputWarningBox"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.displayEmptyInputWarningBox">[docs]</a><span class="k">def</span> <span class="nf">displayEmptyInputWarningBox</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Displays a warning box for the &#39;input&#39; parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">tkinter.messagebox</span> <span class="k">import</span> <span class="n">showwarning</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">tkMessageBox</span> <span class="k">import</span> <span class="n">showwarning</span>

    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;No valid input files found! &#39;</span><span class="o">+</span>\
        <span class="s1">&#39;Please check the value for the &quot;input&quot; parameter.&#39;</span>
        <span class="n">showwarning</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;No valid inputs!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;yes&quot;</span></div>

<div class="viewcode-block" id="displayBadRefimageWarningBox"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.displayBadRefimageWarningBox">[docs]</a><span class="k">def</span> <span class="nf">displayBadRefimageWarningBox</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Displays a warning box for the &#39;input&#39; parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">tkinter.messagebox</span> <span class="k">import</span> <span class="n">showwarning</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">tkMessageBox</span> <span class="k">import</span> <span class="n">showwarning</span>

    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;No refimage with WCS found!</span><span class="se">\n</span><span class="s1"> &#39;</span><span class="o">+</span>\
        <span class="s1">&#39; This could be caused by one of 2 problems:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
        <span class="s1">&#39;   * filename does not specify an extension with a valid WCS.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
        <span class="s1">&#39;   * can not find the file.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>\
        <span class="s1">&#39;Please check the filename specified in the &quot;refimage&quot; parameter.&#39;</span>

        <span class="n">showwarning</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;No valid inputs!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;yes&quot;</span></div>

<div class="viewcode-block" id="updateNEXTENDKw"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.updateNEXTENDKw">[docs]</a><span class="k">def</span> <span class="nf">updateNEXTENDKw</span><span class="p">(</span><span class="n">fobj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Update NEXTEND keyword in PRIMARY header (if present) to accurately</span>
<span class="sd">        reflect the number of extensions in the MEF file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;nextend&#39;</span> <span class="ow">in</span> <span class="n">fobj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
        <span class="n">fobj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;nextend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="count_sci_extensions"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.count_sci_extensions">[docs]</a><span class="k">def</span> <span class="nf">count_sci_extensions</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return the number of SCI extensions and the EXTNAME from a input MEF file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_sci</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">extname</span> <span class="o">=</span> <span class="s1">&#39;SCI&#39;</span>

    <span class="n">hdu_list</span> <span class="o">=</span> <span class="n">fileutil</span><span class="o">.</span><span class="n">openImage</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">extn</span> <span class="ow">in</span> <span class="n">hdu_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;extname&#39;</span> <span class="ow">in</span> <span class="n">extn</span><span class="o">.</span><span class="n">header</span> <span class="ow">and</span> <span class="n">extn</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;extname&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">extname</span><span class="p">:</span>
            <span class="n">num_sci</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">num_sci</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">extname</span> <span class="o">=</span> <span class="s1">&#39;PRIMARY&#39;</span>
        <span class="n">num_sci</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">hdu_list</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">num_sci</span><span class="p">,</span><span class="n">extname</span></div>

<div class="viewcode-block" id="verifyUniqueWcsname"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.verifyUniqueWcsname">[docs]</a><span class="k">def</span> <span class="nf">verifyUniqueWcsname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">wcsname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Report whether or not the specified WCSNAME already exists in the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">uniq</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">numsci</span><span class="p">,</span><span class="n">extname</span> <span class="o">=</span> <span class="n">count_sci_extensions</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">wnames</span> <span class="o">=</span> <span class="n">altwcs</span><span class="o">.</span><span class="n">wcsnames</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="p">(</span><span class="n">extname</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">wcsname</span> <span class="ow">in</span> <span class="n">wnames</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">uniq</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">uniq</span></div>

<div class="viewcode-block" id="verifyUpdatewcs"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.verifyUpdatewcs">[docs]</a><span class="k">def</span> <span class="nf">verifyUpdatewcs</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify the existence of WCSNAME in the file.  If it is not present,</span>
<span class="sd">    report this to the user and raise an exception.  Returns True if WCSNAME</span>
<span class="sd">    was found in all SCI extensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">numsci</span><span class="p">,</span><span class="n">extname</span> <span class="o">=</span> <span class="n">count_sci_extensions</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">numsci</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">extname</span><span class="o">=</span><span class="n">extname</span><span class="p">,</span> <span class="n">extver</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;wcsname&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hdr</span><span class="p">:</span>
            <span class="n">updated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">updated</span></div>

<div class="viewcode-block" id="verifyRefimage"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.verifyRefimage">[docs]</a><span class="k">def</span> <span class="nf">verifyRefimage</span><span class="p">(</span><span class="n">refimage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify that the value of refimage specified by the user points to an</span>
<span class="sd">    extension with a proper WCS defined. It starts by making sure an extension gets</span>
<span class="sd">    specified by the user when using a MEF file. The final check comes by looking</span>
<span class="sd">    for a CD matrix in the WCS object itself. If either test fails, it returns</span>
<span class="sd">    a value of False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># start by trying to see whether the code can even find the file</span>
    <span class="k">if</span> <span class="n">is_blank</span><span class="p">(</span><span class="n">refimage</span><span class="p">):</span>
        <span class="n">valid</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">return</span> <span class="n">valid</span>

    <span class="n">refroot</span><span class="p">,</span><span class="n">extroot</span> <span class="o">=</span> <span class="n">fileutil</span><span class="o">.</span><span class="n">parseFilename</span><span class="p">(</span><span class="n">refimage</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">refroot</span><span class="p">):</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">valid</span>

    <span class="c1"># if a MEF has been specified, make sure extension contains a valid WCS</span>
    <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">extroot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extn</span> <span class="o">=</span> <span class="n">findWCSExtn</span><span class="p">(</span><span class="n">refimage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check for CD matrix in WCS object</span>
            <span class="n">refwcs</span> <span class="o">=</span> <span class="n">wcsutil</span><span class="o">.</span><span class="n">HSTWCS</span><span class="p">(</span><span class="n">refimage</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">refwcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">has_cd</span><span class="p">():</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">del</span> <span class="n">refwcs</span>

    <span class="k">return</span> <span class="n">valid</span></div>

<div class="viewcode-block" id="findWCSExtn"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.findWCSExtn">[docs]</a><span class="k">def</span> <span class="nf">findWCSExtn</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return new filename with extension that points to an extension with a</span>
<span class="sd">        valid WCS.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>
<span class="sd">        extnum : str, None</span>
<span class="sd">            Value of extension name as a string either as provided by the user</span>
<span class="sd">            or based on the extension number for the first extension which</span>
<span class="sd">            contains a valid HSTWCS object.  Returns None if no extension can be</span>
<span class="sd">            found with a valid WCS.</span>

<span class="sd">        Notes</span>
<span class="sd">        =====</span>
<span class="sd">        The return value from this function can be used as input to</span>
<span class="sd">            create another HSTWCS with the syntax::</span>

<span class="sd">                `HSTWCS(&#39;{}[{}]&#39;.format(filename,extnum))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rootname</span><span class="p">,</span><span class="n">extroot</span> <span class="o">=</span> <span class="n">fileutil</span><span class="o">.</span><span class="n">parseFilename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">extnum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">extroot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fimg</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">rootname</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">extn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fimg</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;crval1&#39;</span> <span class="ow">in</span> <span class="n">extn</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
                <span class="n">refwcs</span> <span class="o">=</span> <span class="n">wcsutil</span><span class="o">.</span><span class="n">HSTWCS</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rootname</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">refwcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">has_cd</span><span class="p">():</span>
                    <span class="n">extnum</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="n">fimg</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">refwcs</span> <span class="o">=</span> <span class="n">wcsutil</span><span class="o">.</span><span class="n">HSTWCS</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">refwcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">has_cd</span><span class="p">():</span>
                <span class="n">extnum</span> <span class="o">=</span> <span class="n">extroot</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">extnum</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">extnum</span></div>


<div class="viewcode-block" id="verifyFilePermissions"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.verifyFilePermissions">[docs]</a><span class="k">def</span> <span class="nf">verifyFilePermissions</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="n">chmod</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Verify that images specified in &#39;filelist&#39; can be updated.</span>

<span class="sd">    A message will be printed reporting the names of any images which</span>
<span class="sd">    do not have write-permission, then quit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">badfiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">archive_dir</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fileutil</span><span class="o">.</span><span class="n">osfn</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;OrIg_files&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">archive_dir</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EACCES</span><span class="p">:</span>
                <span class="n">badfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="c1"># Not a permission error.</span>
            <span class="k">pass</span>

    <span class="n">num_bad</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">badfiles</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_bad</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">archive_dir</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Working in &quot;OrIg_files&quot; (archive) directory. &#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    This directory has been created to serve as an archive&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    for the original input images. &#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    These files should be copied into another directory&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;     for processing. &#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found </span><span class="si">%d</span><span class="s1"> files which can not be updated!&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">num_bad</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">badfiles</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Please reset permissions for these files and restart...&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">filelist</span></div>

<div class="viewcode-block" id="getFullParList"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.getFullParList">[docs]</a><span class="k">def</span> <span class="nf">getFullParList</span><span class="p">(</span><span class="n">configObj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a single list of all parameter names included in the configObj</span>
<span class="sd">    regardless of which section the parameter was stored</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">configObj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">configObj</span><span class="p">[</span><span class="n">par</span><span class="p">],</span><span class="n">configobj</span><span class="o">.</span><span class="n">Section</span><span class="p">):</span>
            <span class="n">plist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">getFullParList</span><span class="p">(</span><span class="n">configObj</span><span class="p">[</span><span class="n">par</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plist</span></div>

<div class="viewcode-block" id="validateUserPars"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.validateUserPars">[docs]</a><span class="k">def</span> <span class="nf">validateUserPars</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span><span class="n">input_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Compares input parameter names specified by user with those already</span>
<span class="sd">        recognized by the task.</span>

<span class="sd">        Any parameters provided by the user that does not match a known</span>
<span class="sd">        task parameter will be reported and a ValueError exception will be</span>
<span class="sd">        raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check to see whether any input parameters are unexpected.</span>
    <span class="c1"># Any unexpected parameters provided on input should be reported and</span>
    <span class="c1"># the code should stop</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="n">getFullParList</span><span class="p">(</span><span class="n">configObj</span><span class="p">)</span>
    <span class="n">extra_pars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
            <span class="n">extra_pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_pars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;The following input parameters were not recognized as valid inputs:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">extra_pars</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Please check the spelling of the parameter(s) and try again...&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="applyUserPars_steps"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.applyUserPars_steps">[docs]</a><span class="k">def</span> <span class="nf">applyUserPars_steps</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="s1">&#39;3a&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Apply logic to turn on use of user-specified output WCS if user provides</span>
<span class="sd">        any parameter on command-line regardless of how final_wcs was set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">step_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;7a&#39;</span><span class="p">:</span> <span class="s1">&#39;final_wcs&#39;</span><span class="p">,</span> <span class="s1">&#39;3a&#39;</span><span class="p">:</span> <span class="s1">&#39;driz_sep_wcs&#39;</span><span class="p">}</span>
    <span class="n">stepname</span> <span class="o">=</span> <span class="n">getSectionName</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
    <span class="n">finalParDict</span> <span class="o">=</span> <span class="n">configObj</span><span class="p">[</span><span class="n">stepname</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">finalParDict</span><span class="p">[</span><span class="n">step_kws</span><span class="p">[</span><span class="n">step</span><span class="p">]]</span>

    <span class="c1"># interpret input_dict to find any parameters for this step specified by the user</span>
    <span class="n">user_pars</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">finalParDict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="p">:</span> <span class="n">user_pars</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_pars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">configObj</span><span class="p">[</span><span class="n">stepname</span><span class="p">][</span><span class="n">step_kws</span><span class="p">[</span><span class="n">step</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="getDefaultConfigObj"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.getDefaultConfigObj">[docs]</a><span class="k">def</span> <span class="nf">getDefaultConfigObj</span><span class="p">(</span><span class="n">taskname</span><span class="p">,</span><span class="n">configObj</span><span class="p">,</span><span class="n">input_dict</span><span class="o">=</span><span class="p">{},</span><span class="n">loadOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return default configObj instance for task updated</span>
<span class="sd">        with user-specified values from input_dict.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        taskname : string</span>
<span class="sd">            Name of task to load into TEAL</span>

<span class="sd">        configObj : string</span>
<span class="sd">            The valid values for &#39;configObj&#39; would be::</span>

<span class="sd">                None                      - loads last saved user .cfg file</span>
<span class="sd">                &#39;defaults&#39;                - loads task default .cfg file</span>
<span class="sd">                name of .cfg file (string)- loads user-specified .cfg file</span>

<span class="sd">        input_dict : dict</span>
<span class="sd">            Set of parameters and values specified by user to be different from</span>
<span class="sd">            what gets loaded in from the .cfg file for the task</span>

<span class="sd">        loadOnly : bool</span>
<span class="sd">            Setting &#39;loadOnly&#39; to False causes the TEAL GUI to start allowing the</span>
<span class="sd">            user to edit the values further and then run the task if desired.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">configObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Start by grabbing the default values without using the GUI</span>
        <span class="c1"># This insures that all subsequent use of the configObj includes</span>
        <span class="c1"># all parameters and their last saved values</span>
        <span class="n">configObj</span> <span class="o">=</span> <span class="n">teal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">taskname</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">configObj</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;defaults&#39;</span><span class="p">:</span>
            <span class="c1"># Load task default .cfg file with all default values</span>
            <span class="n">configObj</span> <span class="o">=</span> <span class="n">teal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">taskname</span><span class="p">,</span><span class="n">defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># define default filename for configObj</span>
            <span class="n">configObj</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">taskname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;.cfg&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Load user-specified .cfg file with its special default values</span>
            <span class="c1"># we need to call &#39;fileutil.osfn()&#39; to insure all environment</span>
            <span class="c1"># variables specified by the user in the configObj filename are</span>
            <span class="c1"># expanded to the full path</span>
            <span class="n">configObj</span> <span class="o">=</span> <span class="n">teal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fileutil</span><span class="o">.</span><span class="n">osfn</span><span class="p">(</span><span class="n">configObj</span><span class="p">))</span>

    <span class="c1"># merge in the user values for this run</span>
    <span class="c1"># this, though, does not save the results for use later</span>
    <span class="k">if</span> <span class="n">input_dict</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,{}]:</span><span class="c1"># and configObj not in [None, {}]:</span>
        <span class="c1"># check to see whether any input parameters are unexpected.</span>
        <span class="c1"># Any unexpected parameters provided on input should be reported and</span>
        <span class="c1"># the code should stop</span>
        <span class="n">validateUserPars</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span><span class="n">input_dict</span><span class="p">)</span>

        <span class="c1"># If everything looks good, merge user inputs with configObj and continue</span>
        <span class="n">cfgpars</span><span class="o">.</span><span class="n">mergeConfigObj</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">)</span>
        <span class="c1"># Update the input .cfg file with the updated parameter values</span>
        <span class="c1">#configObj.filename = os.path.join(cfgpars.getAppDir(),os.path.basename(configObj.filename))</span>
        <span class="c1">#configObj.write()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">loadOnly</span><span class="p">:</span>
    <span class="c1"># We want to run the GUI AFTER merging in any parameters</span>
    <span class="c1"># specified by the user on the command-line and provided in</span>
    <span class="c1"># input_dict</span>
        <span class="n">configObj</span> <span class="o">=</span> <span class="n">teal</span><span class="o">.</span><span class="n">teal</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span><span class="n">loadOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">configObj</span></div>

<div class="viewcode-block" id="getSectionName"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.getSectionName">[docs]</a><span class="k">def</span> <span class="nf">getSectionName</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span><span class="n">stepnum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return section label based on step number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">configObj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;STEP &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">stepnum</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">key</span></div>

<div class="viewcode-block" id="getConfigObjPar"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.getConfigObjPar">[docs]</a><span class="k">def</span> <span class="nf">getConfigObjPar</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span> <span class="n">parname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return parameter value without having to specify which section</span>
<span class="sd">        holds the parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cfgpars</span><span class="o">.</span><span class="n">findFirstPar</span><span class="p">(</span><span class="n">configObj</span><span class="p">,</span> <span class="n">parname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="displayMakewcsWarningBox"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.displayMakewcsWarningBox">[docs]</a><span class="k">def</span> <span class="nf">displayMakewcsWarningBox</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Displays a warning box for the &#39;makewcs&#39; parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">tkinter.messagebox</span> <span class="k">import</span> <span class="n">showwarning</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">tkMessageBox</span> <span class="k">import</span> <span class="n">showwarning</span>

    <span class="n">ans</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;yes&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">ans</span><span class="p">[</span><span class="n">display</span><span class="p">]:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Setting &quot;updatewcs=yes&quot; will result &#39;</span><span class="o">+</span> \
              <span class="s1">&#39;in all input WCS values to be recomputed &#39;</span><span class="o">+</span> \
              <span class="s1">&#39;using the original distortion model and alignment.&#39;</span>
        <span class="n">showwarning</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;WCS will be overwritten!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span></div>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">These two functions are for reading in an &#39;at file&#39; which contains</span>
<span class="sd">two columns of filenames, the first column is assumed to</span>
<span class="sd">be the science image and the second column is assumed</span>
<span class="sd">to be the IVM file that is associated with it.</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="atfile_sci"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.atfile_sci">[docs]</a><span class="k">def</span> <span class="nf">atfile_sci</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the filename of the science image</span>
<span class="sd">    which is assumed to be the first word</span>
<span class="sd">    in the atfile the user gave.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="atfile_ivm"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.atfile_ivm">[docs]</a><span class="k">def</span> <span class="nf">atfile_ivm</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the filename of the IVM file</span>
<span class="sd">    which is assumed to be the second word</span>
<span class="sd">    in the atfile the user gave.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="printParams"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.printParams">[docs]</a><span class="k">def</span> <span class="nf">printParams</span><span class="p">(</span><span class="n">paramDictionary</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print nicely the parameters from the dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">log</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">paramDictionary</span><span class="p">:</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;No parameters were supplied&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">paramDictionary</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">all</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paramDictionary</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">))</span> \
            <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; :&#39;</span><span class="p">,</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">paramDictionary</span><span class="p">[</span><span class="n">key</span><span class="p">])]))</span>
        <span class="k">if</span> <span class="n">log</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="print_key"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.print_key">[docs]</a><span class="k">def</span> <span class="nf">print_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">lev</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">logfn</span><span class="o">=</span><span class="nb">print</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">logfn</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">logfn</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">lev</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">print_key</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="n">vl</span><span class="p">,</span> <span class="n">lev</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">logfn</span><span class="o">=</span><span class="n">logfn</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logfn</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">: &#39;</span><span class="si">{:s}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">lev</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logfn</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">lev</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span></div>


<div class="viewcode-block" id="print_cfg"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.print_cfg">[docs]</a><span class="k">def</span> <span class="nf">print_cfg</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">logfn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">logfn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logfn</span> <span class="o">=</span> <span class="nb">print</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="p">:</span>
        <span class="n">logfn</span><span class="p">(</span><span class="s1">&#39;No parameters were supplied&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">smkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">]</span>
    <span class="n">sectkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">]</span>
    <span class="n">stepkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sectkeys</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;STEP &#39;</span><span class="p">)]</span>
    <span class="n">sectkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sectkeys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stepkeys</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">smkeys</span> <span class="o">+</span> <span class="n">sectkeys</span> <span class="o">+</span> <span class="n">stepkeys</span><span class="p">:</span>
        <span class="n">print_key</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">logfn</span><span class="o">=</span><span class="n">logfn</span><span class="p">)</span>
    <span class="n">logfn</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="isASNTable"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.isASNTable">[docs]</a><span class="k">def</span> <span class="nf">isASNTable</span><span class="p">(</span><span class="n">inputFilelist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return TRUE if inputFilelist is a fits ASN file.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;_asn&quot;</span>  <span class="ow">or</span> <span class="s2">&quot;_asc&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">inputFilelist</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="isCommaList"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.isCommaList">[docs]</a><span class="k">def</span> <span class="nf">isCommaList</span><span class="p">(</span><span class="n">inputFilelist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True if the input is a comma separated list of names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputFilelist</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputFilelist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">):</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">inputFilelist</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ilist</span> <span class="o">=</span> <span class="n">inputFilelist</span>
    <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">ilist</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="loadFileList"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.loadFileList">[docs]</a><span class="k">def</span> <span class="nf">loadFileList</span><span class="p">(</span><span class="n">inputFilelist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open up the &#39;@ file&#39; and read in the science and possible</span>
<span class="sd">       ivm filenames from the first two columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">inputFilelist</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="c1"># check the first line in order to determine whether</span>
    <span class="c1"># IVM files have been specified in a second column...</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># If there is a second column...</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># ...parse out the names of the IVM files as well</span>
        <span class="n">ivmlist</span> <span class="o">=</span> <span class="n">irafglob</span><span class="o">.</span><span class="n">irafglob</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">atfile</span><span class="o">=</span><span class="n">atfile_ivm</span><span class="p">)</span>

    <span class="c1"># Parse the @-file with irafglob to extract the input filename</span>
    <span class="n">filelist</span> <span class="o">=</span> <span class="n">irafglob</span><span class="o">.</span><span class="n">irafglob</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">atfile</span><span class="o">=</span><span class="n">atfile_sci</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filelist</span></div>


<div class="viewcode-block" id="readCommaList"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.readCommaList">[docs]</a><span class="k">def</span> <span class="nf">readCommaList</span><span class="p">(</span><span class="n">fileList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a list of the files with the commas removed. &quot;&quot;&quot;</span>
    <span class="n">names</span><span class="o">=</span><span class="n">fileList</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">fileList</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">fileList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fileList</span></div>


<div class="viewcode-block" id="runmakewcs"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.runmakewcs">[docs]</a><span class="k">def</span> <span class="nf">runmakewcs</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs &#39;updatewcs&#39; to recompute the WCS keywords for the input image.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input : list of str</span>
<span class="sd">        A list of file names.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output : list of str</span>
<span class="sd">        Returns a list of names of the modified files</span>
<span class="sd">        (For GEIS files returns the translated names).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newNames</span> <span class="o">=</span> <span class="n">updatewcs</span><span class="o">.</span><span class="n">updatewcs</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">checkfiles</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newNames</span></div>


<div class="viewcode-block" id="update_input"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.update_input">[docs]</a><span class="k">def</span> <span class="nf">update_input</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="n">ivmlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">removed_files</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes files flagged to be removed from the input filelist.</span>
<span class="sd">    Removes the corresponding ivm files if present.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newfilelist</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">removed_files</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="n">filelist</span><span class="p">,</span> <span class="n">ivmlist</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sci_ivm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="n">ivmlist</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">removed_files</span><span class="p">:</span>
            <span class="n">result</span><span class="o">=</span><span class="p">[</span><span class="n">sci_ivm</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">sci_ivm</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">f</span> <span class="p">]</span>
        <span class="n">ivmlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sci_ivm</span><span class="p">]</span>
        <span class="n">newfilelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sci_ivm</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">newfilelist</span><span class="p">,</span> <span class="n">ivmlist</span></div>


<span class="c1">####</span>
<span class="c1">#</span>
<span class="c1"># The following functions were required for use with the drizzling code</span>
<span class="c1"># and were copied in from pydrizzle_tng.py.</span>
<span class="c1">#</span>
<span class="c1">####</span>

<div class="viewcode-block" id="countImages"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.countImages">[docs]</a><span class="k">def</span> <span class="nf">countImages</span><span class="p">(</span><span class="n">imageObjectList</span><span class="p">):</span>
    <span class="n">expnames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imageObjectList</span><span class="p">:</span>
        <span class="n">expnames</span> <span class="o">+=</span> <span class="n">img</span><span class="o">.</span><span class="n">getKeywordList</span><span class="p">(</span><span class="s1">&#39;_expname&#39;</span><span class="p">)</span>
    <span class="n">imgnames</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">nimages</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">expnames</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">imgnames</span><span class="p">:</span>
            <span class="n">imgnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">nimages</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">nimages</span></div>

<div class="viewcode-block" id="get_detnum"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.get_detnum">[docs]</a><span class="k">def</span> <span class="nf">get_detnum</span><span class="p">(</span><span class="n">hstwcs</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">extnum</span><span class="p">):</span>
    <span class="n">detnum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">binned</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">hstwcs</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="n">filename</span> <span class="ow">and</span> <span class="n">hstwcs</span><span class="o">.</span><span class="n">extver</span> <span class="o">==</span> <span class="n">extnum</span><span class="p">:</span>
        <span class="n">detnum</span> <span class="o">=</span> <span class="n">hstwcs</span><span class="o">.</span><span class="n">chip</span>
        <span class="n">binned</span> <span class="o">=</span> <span class="n">hstwcs</span><span class="o">.</span><span class="n">binned</span>

    <span class="k">return</span> <span class="n">detnum</span><span class="p">,</span><span class="n">binned</span></div>

<div class="viewcode-block" id="get_expstart"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.get_expstart">[docs]</a><span class="k">def</span> <span class="nf">get_expstart</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="n">primary_hdr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;shouldn&#39;t this just be defined in the instrument subclass of imageobject?&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;expstart&#39;</span> <span class="ow">in</span> <span class="n">primary_hdr</span><span class="p">:</span>
        <span class="n">exphdr</span> <span class="o">=</span> <span class="n">primary_hdr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exphdr</span> <span class="o">=</span> <span class="n">header</span>

    <span class="k">if</span> <span class="s1">&#39;EXPSTART&#39;</span> <span class="ow">in</span> <span class="n">exphdr</span><span class="p">:</span>
        <span class="n">expstart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">exphdr</span><span class="p">[</span><span class="s1">&#39;EXPSTART&#39;</span><span class="p">])</span>
        <span class="n">expend</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">exphdr</span><span class="p">[</span><span class="s1">&#39;EXPEND&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">expstart</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">expend</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">expstart</span><span class="p">,</span><span class="n">expend</span><span class="p">)</span></div>

<div class="viewcode-block" id="compute_texptime"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.compute_texptime">[docs]</a><span class="k">def</span> <span class="nf">compute_texptime</span><span class="p">(</span><span class="n">imageObjectList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add up the exposure time for all the members in</span>
<span class="sd">    the pattern, since &#39;drizzle&#39; doesn&#39;t have the necessary</span>
<span class="sd">    information to correctly set this itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expnames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">exptimes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">end</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imageObjectList</span><span class="p">:</span>
        <span class="n">expnames</span> <span class="o">+=</span> <span class="n">img</span><span class="o">.</span><span class="n">getKeywordList</span><span class="p">(</span><span class="s1">&#39;_expname&#39;</span><span class="p">)</span>
        <span class="n">exptimes</span> <span class="o">+=</span> <span class="n">img</span><span class="o">.</span><span class="n">getKeywordList</span><span class="p">(</span><span class="s1">&#39;_exptime&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">+=</span> <span class="n">img</span><span class="o">.</span><span class="n">getKeywordList</span><span class="p">(</span><span class="s1">&#39;_expstart&#39;</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">+=</span> <span class="n">img</span><span class="o">.</span><span class="n">getKeywordList</span><span class="p">(</span><span class="s1">&#39;_expend&#39;</span><span class="p">)</span>

    <span class="n">exptime</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">expstart</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">expend</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="n">exposure</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expnames</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">expnames</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="n">exposure</span><span class="p">:</span>
            <span class="n">exposure</span> <span class="o">=</span> <span class="n">expnames</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">exptime</span> <span class="o">+=</span> <span class="n">exptimes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">exptime</span><span class="p">,</span><span class="n">expstart</span><span class="p">,</span><span class="n">expend</span><span class="p">)</span></div>


<div class="viewcode-block" id="computeRange"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.computeRange">[docs]</a><span class="k">def</span> <span class="nf">computeRange</span><span class="p">(</span><span class="n">corners</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Determine the range spanned by an array of pixel positions. &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">_xrange</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">_yrange</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">_xrange</span><span class="p">,</span> <span class="n">_yrange</span></div>


<div class="viewcode-block" id="getRotatedSize"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.getRotatedSize">[docs]</a><span class="k">def</span> <span class="nf">getRotatedSize</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Determine the size of a rotated (meta)image.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">angle</span><span class="p">:</span>
        <span class="n">_rotm</span> <span class="o">=</span> <span class="n">fileutil</span><span class="o">.</span><span class="n">buildRotMatrix</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="c1"># Rotate about the center</span>
        <span class="n">_corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">_rotm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If there is no rotation, simply return original values</span>
        <span class="n">_corners</span> <span class="o">=</span> <span class="n">corners</span>

    <span class="k">return</span> <span class="n">computeRange</span><span class="p">(</span><span class="n">_corners</span><span class="p">)</span></div>


<div class="viewcode-block" id="readcols"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.readcols">[docs]</a><span class="k">def</span> <span class="nf">readcols</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">hms</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the columns from an ASCII file as numpy arrays.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    infile : str</span>
<span class="sd">        Filename of ASCII file with array data as columns.</span>

<span class="sd">    cols : list of int</span>
<span class="sd">        List of 0-indexed column numbers for columns to be turned into numpy arrays</span>
<span class="sd">        (DEFAULT- [0,1,2,3]).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    outarr : list of numpy arrays</span>
<span class="sd">        Simple list of numpy arrays in the order as specifed in the &#39;cols&#39; parameter.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">outarr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;INDEF&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span> <span class="k">continue</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">lnew</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lnew</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span> <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">l</span> <span class="o">=</span> <span class="n">lnew</span>
        <span class="n">lspl</span> <span class="o">=</span> <span class="n">lnew</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outarr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span> <span class="n">outarr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)))):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hms</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lspl</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">lspl</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">outarr</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="n">fin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
        <span class="n">outarr</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outarr</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">outarr</span></div>

<div class="viewcode-block" id="parse_colnames"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.parse_colnames">[docs]</a><span class="k">def</span> <span class="nf">parse_colnames</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert colnames input into list of column numbers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colnames</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">colnames</span> <span class="o">=</span> <span class="n">colnames</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="c1"># parse column names from coords file and match to input values</span>
    <span class="k">if</span> <span class="n">coords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fileutil</span><span class="o">.</span><span class="n">isFits</span><span class="p">(</span><span class="n">coords</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="c1"># Open FITS file with table</span>
        <span class="n">ftab</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># determine which extension has the table</span>
        <span class="k">for</span> <span class="n">extn</span> <span class="ow">in</span> <span class="n">ftab</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">extn</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="p">):</span>
                <span class="c1"># parse column names from table and match to inputs</span>
                <span class="n">cnames</span> <span class="o">=</span> <span class="n">extn</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span>
                <span class="k">if</span> <span class="n">colnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">colnames</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cnames</span><span class="p">)))):</span>
                            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">colnames</span><span class="p">):</span>
                        <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Not all input columns found in table...&quot;</span>
                        <span class="n">ftab</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="n">cnames</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="n">ftab</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">colnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Unsupported column names...&quot;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cols</span></div>


<div class="viewcode-block" id="createFile"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.createFile">[docs]</a><span class="k">def</span> <span class="nf">createFile</span><span class="p">(</span><span class="n">dataArray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a simple fits file for the given data array and header.</span>
<span class="sd">    Returns either the FITS object in-membory when outfile==None or</span>
<span class="sd">    None when the FITS file was written out to a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Insure that at least a data-array has been provided to create the file</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">dataArray</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;Please supply a data array for createFiles&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create the output file</span>
        <span class="n">fitsobj</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS1&#39;</span><span class="p">])</span>
                <span class="k">del</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS2&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;XTENSION&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;XTENSION&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;EXTNAME&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXTNAME&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;EXTVER&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXTVER&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="s1">&#39;NEXTEND&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;NEXTEND&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dataArray</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PCOUNT&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;GCOUNT&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dataArray</span><span class="p">)</span>

        <span class="n">fitsobj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fitsobj</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># CLOSE THE IMAGE FILES</span>
        <span class="n">fitsobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">fitsobj</span>
            <span class="n">fitsobj</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">fitsobj</span></div>

<div class="viewcode-block" id="base_taskname"><a class="viewcode-back" href="../../utilfuncs.html#drizzlepac.util.base_taskname">[docs]</a><span class="k">def</span> <span class="nf">base_taskname</span><span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="n">packagename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the base name of the task.</span>

<span class="sd">    Many tasks in the `drizzlepac` have &quot;compound&quot; names such as</span>
<span class="sd">    &#39;drizzlepac.sky&#39;. This function will search for the presence of a dot</span>
<span class="sd">    in the input `taskname` and if found, it will return the string</span>
<span class="sd">    to the right of the right-most dot. If a dot is not found, it will return</span>
<span class="sd">    the input string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    taskname : str, None</span>
<span class="sd">        Full task name. If it is `None`, :py:func:`base_taskname` will</span>
<span class="sd">        return `None`\ .</span>

<span class="sd">    packagename : str, None (Default = None)</span>
<span class="sd">        Package name. It is assumed that a compound task name is formed by</span>
<span class="sd">        concatenating `packagename` + &#39;.&#39; + `taskname`\ . If `packagename`</span>
<span class="sd">        is not `None`, :py:func:`base_taskname` will check that the string</span>
<span class="sd">        to the left of the right-most dot matches `packagename` and will</span>
<span class="sd">        raise an `AssertionError` if the package name derived from the</span>
<span class="sd">        input `taskname` does not match the supplied `packagename`\ . This</span>
<span class="sd">        is intended as a check for discrepancies that may arise</span>
<span class="sd">        during the development of the tasks. If `packagename` is `None`,</span>
<span class="sd">        no such check will be performed.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AssertionError</span>
<span class="sd">        Raised when package name derived from the input `taskname` does not</span>
<span class="sd">        match the supplied `packagename`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">taskname</span>

    <span class="n">indx</span> <span class="o">=</span> <span class="n">taskname</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">indx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">base_taskname</span> <span class="o">=</span> <span class="n">taskname</span><span class="p">[(</span><span class="n">indx</span><span class="o">+</span><span class="mi">1</span><span class="p">):]</span>
        <span class="n">pkg_name</span>      <span class="o">=</span> <span class="n">taskname</span><span class="p">[:</span><span class="n">indx</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base_taskname</span> <span class="o">=</span> <span class="n">taskname</span>
        <span class="n">pkg_name</span>      <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">assert</span><span class="p">(</span><span class="kc">True</span> <span class="k">if</span> <span class="n">packagename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">packagename</span> <span class="o">==</span> <span class="n">pkg_name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">base_taskname</span></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Warren Hack, Nadia Dencheva, Chris Sontag, Megan Sosey, Michael Droettboom, Mihai Cara.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.2.6 (2018-11-02 15:37:13 -0400)',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>