

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TWEAKREG: Alignment of Images &mdash; DrizzlePac 2.2.6 (2018-11-02 15:37:13 -0400) documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/stsci.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/stsci.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="DrizzlePac 2.2.6 (2018-11-02 15:37:13 -0400) documentation" href="index.html"/>
        <link rel="next" title="Refmagefindpars: Source finding parameters for the reference image" href="refimagefindpars.html"/>
        <link rel="prev" title="DrizzlePac Release Notes" href="CHANGELOG.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="index.html" class="icon icon-home"> DrizzlePac
            
            <img src="_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
              <div class="version">
                2.2.6
              </div>
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="astrodrizzle.html">Primary User Interface: AstroDrizzle()</a></li>
<li class="toctree-l1"><a class="reference internal" href="imageobject.html">imageObject Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="process.html">Step 1: Process Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="static.html">Step 2: Generate a Static Mask</a></li>
<li class="toctree-l1"><a class="reference internal" href="sky.html">Step 3: Subtracting the Sky</a></li>
<li class="toctree-l1"><a class="reference internal" href="adrizzle.html">Step 4 and 8: Drizzling the Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="median.html">Step 5: Create a Median Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="ablot.html">Step 6: Blotting the Median Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="drizcr.html">Step 7: Cosmic-ray identification</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="tweakback.html">Tweakback</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">LICENSE</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">DrizzlePac Release Notes</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">TWEAKREG: Alignment of Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="refimagefindpars.html">Refmagefindpars: Source finding parameters for the reference image</a></li>
<li class="toctree-l1"><a class="reference internal" href="imagefindpars.html">Imagefindpars: Source finding parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">Image Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="catalogs.html">Classes to manage Catalogs and WCS’s</a></li>
<li class="toctree-l1"><a class="reference internal" href="wcscorr.html">Functions to Manage WCS Table Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="wcscorr.html#functions-to-manage-legacy-opus-wcs-keywords-in-the-wcs-table">Functions to Manage Legacy OPUS WCS Keywords in the WCS Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="tweakutils.html">TWEAKUTILS: Utility Functions for Tweakreg</a></li>
<li class="toctree-l1"><a class="reference internal" href="updatehdr.html">UPDATEHDR: Functions for Updating WCS with New Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapreg.html">Region mapping for TweakReg</a></li>
<li class="toctree-l1"><a class="reference internal" href="photeq.html">Photometric equalization for AstroDrizzle</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pixtopix.html">pixtopix: Coordinate transformation to/from drizzled images</a></li>
<li class="toctree-l1"><a class="reference internal" href="pixtosky.html">pixtosky: Coordinate transformation to sky coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="skytopix.html">skytopix: Coordinate transformation from sky coordinates</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="updatenpol.html">Updatenpol</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="runastrodriz.html">Running Astrodriz</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">DrizzlePac</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>TWEAKREG: Alignment of Images</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tweakreg.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tweakreg-alignment-of-images">
<span id="tweakreg"></span><h1>TWEAKREG: Alignment of Images<a class="headerlink" href="#tweakreg-alignment-of-images" title="Permalink to this headline">¶</a></h1>
<p>Combining images using astrodrizzle requires that the WCS information in
the headers of each input image align to within sub-pixel accuracy.
The <code class="xref py py-obj docutils literal notranslate"><span class="pre">tweakreg</span></code> task allows the user to align sets of images to each
other and/or to and external astrometric reference frame or image.</p>
<span class="target" id="module-drizzlepac.tweakreg"></span><p><a class="reference internal" href="#drizzlepac.tweakreg.TweakReg" title="drizzlepac.tweakreg.TweakReg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TweakReg</span></code></a> - A replacement for IRAF-based <code class="xref py py-obj docutils literal notranslate"><span class="pre">tweakshifts</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Authors:</th><td class="field-body">Warren Hack, Mihai Cara</td>
</tr>
<tr class="field-even field"><th class="field-name">License:</th><td class="field-body"><a class="reference internal" href="LICENSE.html"><span class="doc">LICENSE</span></a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="drizzlepac.tweakreg.TweakReg">
<code class="descclassname">drizzlepac.tweakreg.</code><code class="descname">TweakReg</code><span class="sig-paren">(</span><em>files=None</em>, <em>editpars=False</em>, <em>configobj=None</em>, <em>imagefindcfg=None</em>, <em>refimagefindcfg=None</em>, <em>**input_dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/drizzlepac/tweakreg.html#TweakReg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#drizzlepac.tweakreg.TweakReg" title="Permalink to this definition">¶</a></dt>
<dd><p>Tweakreg provides an automated interface for computing residual shifts
between input exposures being combined using <code class="xref py py-obj docutils literal notranslate"><span class="pre">AstroDrizzle</span></code>. The offsets
computed by Tweakreg correspond to pointing differences after applying the WCS
information from the input image’s headers.  Such errors would, for example,
be due to errors in guide-star positions when combining observations from
different observing visits or from slight offsets introduced upon re-acquiring
the guide stars in a slightly different position.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>file</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str or list of str  (Default = <code class="docutils literal notranslate"><span class="pre">'*flt.fits'</span></code>)</span></dt>
<dd><p class="first">Input files (passed in from <em>files</em> parameter)
This paramater can be provided in any of several forms:</p>
<blockquote class="last">
<div><ul class="simple">
<li>filename of a single image</li>
<li>filename of an association (ASN)table</li>
<li>wild-card specification for files in directory (using <code class="docutils literal notranslate"><span class="pre">\*</span></code>, <code class="docutils literal notranslate"><span class="pre">?</span></code> etc.)</li>
<li>comma-separated list of filenames</li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;file</span></code> filelist containing list of desired input filenames with one
filename on each line of the file.</li>
</ul>
</div></blockquote>
</dd>
<dt><strong>editpars</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = False)</span></dt>
<dd><p class="first last">A parameter that allows user to edit input parameters by hand in the GUI.
<a class="reference external" href="https://docs.python.org/2/library/constants.html#True" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a> to use the GUI to edit parameters.</p>
</dd>
<dt><strong>configobj</strong> <span class="classifier-delimiter">:</span> <span class="classifier">ConfigObjPars, ConfigObj, dict (Default = None)</span></dt>
<dd><p class="first last">An instance of <code class="xref py py-obj docutils literal notranslate"><span class="pre">stsci.tools.cfgpars.ConfigObjPars</span></code> or
<code class="xref py py-obj docutils literal notranslate"><span class="pre">stsci.tools.configobj.ConfigObj</span></code> which overrides default parameter
settings. When <code class="docutils literal notranslate"><span class="pre">configobj</span></code> is <code class="xref py py-obj docutils literal notranslate"><span class="pre">defaults</span></code>, default parameter values are
loaded from the user local configuration file usually located in
<code class="docutils literal notranslate"><span class="pre">~/.teal/tweakreg.cfg</span></code> or a matching configuration file in the
current directory. This configuration file stores most recent
settings that an user used when running <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> through the
<code class="docutils literal notranslate"><span class="pre">TEAL</span></code> interface. When <code class="docutils literal notranslate"><span class="pre">configobj</span></code> is <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code>
parameters not provided explicitly will be initialized with their
default values as described in the “Other Parameters” section.</p>
</dd>
<dt><strong>imagefindcfg</strong> <span class="classifier-delimiter">:</span> <span class="classifier">dict, configObject (Default = None)</span></dt>
<dd><p class="first last">An instance of <a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">configObject</span></code> which overrides default source
finding (for input images) parameter settings. See help for
<code class="xref py py-obj docutils literal notranslate"><span class="pre">imagefindpars</span></code> PSET for a list of available parameters. <strong>Only</strong> the
parameters that are different from default values  <strong>need</strong> to be specified
here.</p>
</dd>
<dt><strong>refimagefindcfg</strong> <span class="classifier-delimiter">:</span> <span class="classifier">dict, configObject (Default = None)</span></dt>
<dd><p class="first last">An instance of <a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">configObject</span></code> which overrides default source
finding (for input reference image) parameter settings. See help for
<code class="xref py py-obj docutils literal notranslate"><span class="pre">refimagefindpars</span></code> PSET for a list of available parameters. <strong>Only</strong> the
parameters that are different from default values <strong>need</strong> to be specified
here.</p>
</dd>
<dt><strong>input_dict</strong> <span class="classifier-delimiter">:</span> <span class="classifier">dict, optional</span></dt>
<dd><p class="first">An optional list of parameters specified by the user, which can also
be used to override the defaults.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This list of parameters <strong>can</strong> include the <code class="docutils literal notranslate"><span class="pre">updatewcs</span></code>
parameter, even though this parameter no longer can be set through
the TEAL GUI.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This list of parameters <strong>can</strong> contain parameters specific
to the <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> task itself described here in the “Other Parameters”
section and <strong>may not</strong> contain parameters from the <code class="docutils literal notranslate"><span class="pre">refimagefindpars</span></code>
PSET.</p>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For compatibility purpose with previous <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> versions,
<code class="docutils literal notranslate"><span class="pre">input_dict</span></code> may contain parameters from the the <code class="docutils literal notranslate"><span class="pre">imagefindpars</span></code>
PSET. However, if <code class="docutils literal notranslate"><span class="pre">imagefindcfg</span></code> is not <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, then <code class="docutils literal notranslate"><span class="pre">imagefindpars</span></code>
parameters specified through <code class="docutils literal notranslate"><span class="pre">input_dict</span></code> may not duplicate
parameters specified through <code class="docutils literal notranslate"><span class="pre">imagefindcfg</span></code>.</p>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><dl class="first last docutils">
<dt><strong>refimage</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = ‘’)</span></dt>
<dd><p class="first last">Filename of reference image. Sources derived from this image will be
used as the reference for matching with sources from all input images
unless a separate catalog is provided through the <code class="xref py py-obj docutils literal notranslate"><span class="pre">refcat</span></code> parameter.
In addition, this image file must contain a valid not distorted WCS that
will define the projection plane in which image alignment is performed
(“reference WCS”). When <code class="docutils literal notranslate"><span class="pre">refimage</span></code> is not provided, a reference WCS
will be derived from input images.</p>
</dd>
<dt><strong>expand_refcat</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = False)</span></dt>
<dd><p class="first last">Specifies whether to add new sources from just matched images to
the reference catalog to allow next image to be matched against an
expanded reference catalog.</p>
</dd>
<dt><strong>enforce_user_order</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = True)</span></dt>
<dd><p class="first last">Specifies whether images should be aligned in the order specified in
the <a class="reference external" href="https://docs.python.org/2/library/functions.html#file" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">file</span></code></a> input parameter or <a class="reference internal" href="#drizzlepac.tweakreg.TweakReg" title="drizzlepac.tweakreg.TweakReg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TweakReg</span></code></a> should optimize the order
of alignment by intersection area of the images. Default value (<a class="reference external" href="https://docs.python.org/2/library/constants.html#True" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>)
will align images in the user specified order, except when some images
cannot be aligned in which case <a class="reference internal" href="#drizzlepac.tweakreg.TweakReg" title="drizzlepac.tweakreg.TweakReg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TweakReg</span></code></a> will optimize the image
alignment order. Alignment order optimization is available <em>only</em>
when <code class="xref py py-obj docutils literal notranslate"><span class="pre">expand_refcat</span></code> = <a class="reference external" href="https://docs.python.org/2/library/constants.html#True" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.</p>
</dd>
<dt><strong>exclusions: string (Default = ‘’)</strong></dt>
<dd><p class="first">This parameter allows the user to specify a set of files which contain
regions in the image to ignore (or to include) when finding sources.
This file MUST have 1 line for each input image with the name of the input
file in the first column.  Subsequent columns would be used to specify an
inclusion and/or exclusion file for each chip in <code class="docutils literal notranslate"><span class="pre">'SCI,&lt;n&gt;'</span></code> index order.
If a chip does not require an exclusion file, the string <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> or <code class="docutils literal notranslate"><span class="pre">INDEF</span></code>
can be used as a placeholder for that chip. Each exclusion file can be
either a mask provided as a simple FITS file or a region file in DS9-format.</p>
<p>When a mask file is provided, <a class="reference internal" href="#drizzlepac.tweakreg.TweakReg" title="drizzlepac.tweakreg.TweakReg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TweakReg</span></code></a> will look for the first image-like
extension with image data of the same dimensions as the input image. Zeros
in the mask will be interpreted as “bad” (excluded from search) pixels
while non-zero pixels will be interpreted as “good” pixels. It is
recommended that mask files be FITS files without extensions and mask data
(preferably of integer type) reside in the primary HDU.</p>
<p>If a region file is provided then it should conform to the ‘region’ file
format generated by DS9. The region files can contain both regular
(“include”) regions as well as “exclude” regions. Regular (“include”)
regions indicate the regions of the image that should be searched for
sources while “exclude” regions indicate parts of the image that should
not be used for source detection. The “ruler”, “compass”, and “projection”
regions are not supported (ignored). When <strong>all regions</strong>
in a region file are “exclude” regions, then it will be assumed that the
entire image is “good” before the exclude regions are processed. In other
words, an “include” region corresponding to the entire image will be
<em>prepended</em> to the list of exclude regions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Regions in a region file are processed in the order they appear in the
region file. Thus, when region files contain <em>both</em> “include” and
“exclude” regions, the order in which these regions appear may affect
the results.</p>
</div>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p><a class="reference internal" href="#drizzlepac.tweakreg.TweakReg" title="drizzlepac.tweakreg.TweakReg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TweakReg</span></code></a> relies on <code class="xref py py-obj docutils literal notranslate"><span class="pre">pyregion</span></code> package for work with region files. At the
time of writing, <code class="xref py py-obj docutils literal notranslate"><span class="pre">pyregion</span></code> uses a different algorithm from DS9 for
converting regions from sky coordinates to image coordinate
(this conversion is performed before regions are converted to masks).
For these reasons, regions provided in sky coordinates may not produce
the expected (from DS9) results. While in most instances these
discrepancies should be tolerable, it is important to keep this in mind.</p>
<p class="last">During testing it was observed that conversion to image coordinates is
most accurate for polygonal regions and less accurate for other regions
Therefore, if one must provide regions in sky coordinates, it is
types. recommended to use polygonal and circular regions and to avoid
elliptical and rectangular regions as their conversion to image
coordinates is less accurate. One may use <code class="docutils literal notranslate"><span class="pre">mapreg</span></code> task in the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">drizzlepac</span></code> package to convert region files from sky coordinates to image
coordinates. This will allow one to see the actual regions that will be
used by source finding routine in <a class="reference internal" href="#drizzlepac.tweakreg.TweakReg" title="drizzlepac.tweakreg.TweakReg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TweakReg</span></code></a>.</p>
</div>
</dd>
<dt><strong>updatewcs</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = No)</span></dt>
<dd><p class="first last"><strong>NOT available through TEAL GUI interface.</strong>
This parameter can only be set through the Python interface to Tweakreg by
passing it in as part of the input_dict in order to insure that running
<code class="xref py py-obj docutils literal notranslate"><span class="pre">updatewcs</span></code> <strong>does not overwrite</strong> a previously determined solution written out
to the input file headers.</p>
</dd>
<dt><strong>writecat</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = Yes)</span></dt>
<dd><p class="first last">Specify whether or not to write out the source catalogs generated for
each input image by the built-in source extraction algorithm.</p>
</dd>
<dt><strong>clean</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = No)</span></dt>
<dd><p class="first last">Specify whether or not to remove the temporary files created by
<code class="xref py py-obj docutils literal notranslate"><span class="pre">tweakreg</span></code>, including any catalog files generated for the shift
determination.</p>
</dd>
<dt><strong>interactive</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = Yes)</span></dt>
<dd><p class="first last">This switch controls whether the program stops and waits for the user to
examine any generated plots before continuing on to the next image.  If
turned off, plots will still be displayed, but they will also be saved to
disk automatically as a PNG image with an autogenerated name without
requiring any user input.</p>
</dd>
<dt><strong>verbose</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = No)</span></dt>
<dd><p class="first last">Specify whether or not to print extra messages during
processing.</p>
</dd>
<dt><strong>runfile</strong> <span class="classifier-delimiter">:</span> <span class="classifier">string (Default = ‘tweakreg.log’)</span></dt>
<dd><p class="first last">Specify the filename of the processing log.</p>
</dd>
<dt><strong>*UPDATE HEADER*</strong></dt>
<dd></dd>
<dt><strong>updatehdr</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = No)</span></dt>
<dd><p class="first last">Specify whether or not to update the headers of each input image
directly with the shifts that were determined. This will allow the
input images to be combined by <code class="xref py py-obj docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> without having to provide
the shiftfile as well.</p>
</dd>
<dt><strong>wcsname</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = ‘TWEAK’)</span></dt>
<dd><p class="first last">Name of updated WCS.</p>
</dd>
<dt><strong>reusename</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = False)</span></dt>
<dd><p class="first last">Allows overwriting of an existing WCS with the same name as
specified by <code class="xref py py-obj docutils literal notranslate"><span class="pre">wcsname</span></code> parameter.</p>
</dd>
<dt><strong>*HEADERLET CREATION*</strong></dt>
<dd></dd>
<dt><strong>headerlet: bool (Default = No)</strong></dt>
<dd><p class="first last">Specify whether or not to generate a headerlet from the images at
the end of the task? If turned on, this will create a headerlet
from the images regardless of the value of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">updatehdr</span></code>
parameter.</p>
</dd>
<dt><strong>attach: bool (Default = Yes)</strong></dt>
<dd><p class="first last">If creating a headerlet, choose whether or not to attach the new
headerlet to the input image as a new extension.</p>
</dd>
<dt><strong>hdrfile: string (Default = ‘’)</strong></dt>
<dd><p class="first last">Filename to use for writing out headerlet to a separate file. If the name
does not contain <code class="docutils literal notranslate"><span class="pre">.fits</span></code>, it will create a filename from the
rootname of the input image, the value of this string, and it will end
in <code class="docutils literal notranslate"><span class="pre">'_hlet.fits'</span></code>. For example, if only <code class="docutils literal notranslate"><span class="pre">'hdrlet1'</span></code> is given, the
full filename created will be <code class="docutils literal notranslate"><span class="pre">'j99da1f2q_hdrlet1_hlet.fits'</span></code> when
creating a headerlet for image <code class="docutils literal notranslate"><span class="pre">'j99da1f2q_flt.fits'</span></code>.</p>
</dd>
<dt><strong>clobber: bool (Default = No)</strong></dt>
<dd><p class="first last">If a headerlet with ‘hdrfile’ already exists on disk, specify
whether or not to overwrite that previous file.</p>
</dd>
<dt><strong>hdrname: string (Default = ‘’)</strong></dt>
<dd><p class="first last">Unique name to give to headerlet solution. This name will be used to
identify this specific WCS alignment solution contained in the headerlet.</p>
</dd>
<dt><strong>author: string, optional (Default = ‘’)</strong></dt>
<dd><p class="first last">Name of the creator of the headerlet.</p>
</dd>
<dt><strong>descrip: string, optional (Default = ‘’)</strong></dt>
<dd><p class="first last">Short (1-line) description to be included in headerlet as <code class="docutils literal notranslate"><span class="pre">DESCRIP</span></code> keyword.
This can be used to provide a quick look description of the WCS alignment
contained in the headerlet.</p>
</dd>
<dt><strong>catalog: string, optional (Default = ‘’)</strong></dt>
<dd><p class="first last">Name of reference catalog used as the basis for the image alignment.</p>
</dd>
<dt><strong>history: string, optional (Default = ‘’)</strong></dt>
<dd><p class="first last">Filename of a file containing detailed information regarding the history
of the WCS solution contained in the headerlet. This can include information
on the catalog used for the alignment, or notes on processing that went
into finalizing the WCS alignment stored in this headerlet. This information
will be reformatted as 70-character wide FITS HISTORY keyword section.</p>
</dd>
<dt><strong>*OPTIONAL SHIFTFILE OUTPUT*</strong></dt>
<dd></dd>
<dt><strong>shiftfile</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = No)</span></dt>
<dd><p class="first last">Create output shiftfile?</p>
</dd>
<dt><strong>outshifts</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = ‘shifts.txt’)</span></dt>
<dd><p class="first last">The name for the output shift file created by <code class="xref py py-obj docutils literal notranslate"><span class="pre">tweakreg</span></code>.  This
shiftfile will be formatted for use as direct input to <code class="xref py py-obj docutils literal notranslate"><span class="pre">AstroDrizzle</span></code>.</p>
</dd>
<dt><strong>outwcs</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str  (Default = ‘shifts_wcs.fits’)</span></dt>
<dd><p class="first last">Filename to be given to the OUTPUT reference WCS file created
by <code class="xref py py-obj docutils literal notranslate"><span class="pre">tweakreg</span></code>. This reference WCS defines the WCS from which the
shifts get measured, and will be used by <code class="xref py py-obj docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> to interpret
those shifts. This reference WCS file will be a FITS file that
only contains the WCS keywords in a Primary header with no image
data itself. The values will be derived from the FIRST input image
specified.</p>
</dd>
<dt><strong>*COORDINATE FILE DESCRIPTION*</strong></dt>
<dd></dd>
<dt><strong>catfile</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = ‘’)</span></dt>
<dd><p class="first">Name of file that contains a list of input images and associated
catalog files generated by the user. Each line of this file will
contain the name of an input image in the first column. The remaining
columns will provide the names of the source catalogs for each chip
in order of the science extension numbers ((SCI,1), (SCI,2), …).</p>
<p>A sample catfile, with one line per image would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image1_flt</span><span class="o">.</span><span class="n">fts</span>  <span class="n">cat1_sci1</span><span class="o">.</span><span class="n">coo</span>  <span class="n">cat1_sci2</span><span class="o">.</span><span class="n">coo</span>
<span class="n">image2_flt</span><span class="o">.</span><span class="n">fts</span>  <span class="n">cat2_sci1</span><span class="o">.</span><span class="n">coo</span>  <span class="n">cat2_sci2</span><span class="o">.</span><span class="n">coo</span>
</pre></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Catalog files themselves must be text files containing
“white space”-separated list of values (<code class="docutils literal notranslate"><span class="pre">xcol</span></code>, <code class="docutils literal notranslate"><span class="pre">ycol</span></code>, etc.)</p>
</div>
</dd>
<dt><strong>xcol</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = 1)</span></dt>
<dd><p class="first last">Column number of X position from the user-generated catalog files
specified in the catfile.</p>
</dd>
<dt><strong>ycol</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = 2)</span></dt>
<dd><p class="first last">Column number of Y position from the user-generated catalog files
specified in the catfile.</p>
</dd>
<dt><strong>fluxcol</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = None)</span></dt>
<dd><p class="first last">Column number for the flux values from the user-generated catalog
files specified in the catfile. These values will only be used if
a flux limit has been specified by the user using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">maxflux</span></code> or
<code class="xref py py-obj docutils literal notranslate"><span class="pre">minflux</span></code> parameters.</p>
</dd>
<dt><strong>maxflux</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = None)</span></dt>
<dd><p class="first last">Limiting flux value for selecting valid objects in the input image’s
catalog.  If specified, this flux will serve as the upper limit of a
range for selecting objects to be used in matching with objects
identified in the reference image. If the value is set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, all
objects with fluxes brighter than the minimum specified in <code class="xref py py-obj docutils literal notranslate"><span class="pre">minflux</span></code>
will be used. If both values are set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, all objects will be used.</p>
</dd>
<dt><strong>minflux</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = None)</span></dt>
<dd><p class="first last">Limiting flux value for selecting valid objects in the input image’s
catalog. If specified, this flux value will serve as the lower limit
of a range for selecting objects to be used in matching with objects
identified in the reference image. If the value is set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, all
objects fainter than the limit specified by <code class="xref py py-obj docutils literal notranslate"><span class="pre">maxflux</span></code> will be used.
If both values are set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, all objects will be used.</p>
</dd>
<dt><strong>fluxunits</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str {‘counts’, ‘cps’, ‘mag’} (Default = ‘counts’)</span></dt>
<dd><p class="first last">This allows the task to correctly interpret the flux limits specified
by <code class="xref py py-obj docutils literal notranslate"><span class="pre">maxflux</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">minflux</span></code> when sorting the object list for trimming
of fainter objects.</p>
</dd>
<dt><strong>xyunits</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str {‘pixels’, ‘degrees’} (Default = ‘pixels’)</span></dt>
<dd><p class="first last">Specifies whether the positions in this catalog are already sky pixel
positions, or whether they need to be transformed to the sky.</p>
</dd>
<dt><strong>nbright</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = None)</span></dt>
<dd><p class="first last">The number of brightest objects to keep after sorting the full object
list. If nbright is set equal to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, all objects will be used.</p>
</dd>
<dt><strong>*REFERENCE CATALOG DESCRIPTION*</strong></dt>
<dd></dd>
<dt><strong>refcat</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = ‘’)</span></dt>
<dd><p class="first">Name of the external reference catalog file to be used in place of the
catalog extracted from one of the input images. When <code class="xref py py-obj docutils literal notranslate"><span class="pre">refimage</span></code> is not
specified, reference WCS to be used with reference catalog will be
derived from input images.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Reference catalog must be text file containing
“white space”-separated list of values (<code class="docutils literal notranslate"><span class="pre">xcol</span></code>, <code class="docutils literal notranslate"><span class="pre">ycol</span></code>, etc.)</p>
</div>
</dd>
<dt><strong>refxcol</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = 1)</span></dt>
<dd><p class="first last">Column number of RA in the external catalog file specified by the
refcat.</p>
</dd>
<dt><strong>refycol</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = 2)</span></dt>
<dd><p class="first last">Column number of Dec in the external catalog file specified by the
refcat.</p>
</dd>
<dt><strong>refxyunits</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str {‘pixels’,’degrees’} (Default = ‘degrees’)</span></dt>
<dd><p class="first last">Units of sky positions.</p>
</dd>
<dt><strong>rfluxcol</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = None)</span></dt>
<dd><p class="first last">Column number of flux/magnitude values in the external catalog file
specified by the refcat.</p>
</dd>
<dt><strong>rmaxflux</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = None)</span></dt>
<dd><p class="first last">Limiting flux value used to select valid objects in the external
catalog. If specified, the flux value will serve as the upper limit
of a range for selecting objects to be used in matching with objects
identified in the reference image. If the value is set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>,
all objects with fluxes brighter than the minimum specified in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">rminflux</span></code> will be used. If both values are set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, all
objects will be used.</p>
</dd>
<dt><strong>rminflux</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = None)</span></dt>
<dd><p class="first last">Limiting flux value used to select valid objects in the external
catalog. If specified, the flux will serve as the lower limit
of a range for selecting objects to be used in matching with objects
identified in the reference image. If the value is set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>,
all objects fainter than the limit specified by <code class="xref py py-obj docutils literal notranslate"><span class="pre">rmaxflux</span></code> will be
used. If both values are set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, all objects will be used.</p>
</dd>
<dt><strong>rfluxunits</strong> <span class="classifier-delimiter">:</span> <span class="classifier">{‘counts’, ‘cps’, ‘mag’} (Default = ‘mag’)</span></dt>
<dd><p class="first last">This allows the task to correctly interpret the flux limits specified
by <code class="xref py py-obj docutils literal notranslate"><span class="pre">rmaxflux</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">rminflux</span></code> when sorting the object list for trimming
of fainter objects.</p>
</dd>
<dt><strong>refnbright</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = None)</span></dt>
<dd><p class="first last">Number of brightest objects to keep after sorting the full object
list. If refnbright is set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, all objects will be used. Used in
conjunction with refcat.</p>
</dd>
<dt><strong>*OBJECT MATCHING PARAMETERS*</strong></dt>
<dd></dd>
<dt><strong>minobj</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = 15)</span></dt>
<dd><p class="first last">Minimum number of identified objects from each input image to use
in matching objects from other images.</p>
</dd>
<dt><strong>searchrad</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = 1.0)</span></dt>
<dd><p class="first last">The search radius for a match.</p>
</dd>
<dt><strong>searchunits</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = ‘arcseconds’)</span></dt>
<dd><p class="first last">Units for search radius.</p>
</dd>
<dt><strong>use2dhist</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = Yes)</span></dt>
<dd><p class="first last">Use 2d histogram to find initial offset?</p>
</dd>
<dt><strong>see2dplot</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = Yes)</span></dt>
<dd><p class="first last">See 2d histogram for initial offset?</p>
</dd>
<dt><strong>tolerance</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = 1.0)</span></dt>
<dd><p class="first last">The matching tolerance in pixels after applying an initial solution
derived from the ‘triangles’ algorithm.  This parameter gets passed
directly to <code class="xref py py-obj docutils literal notranslate"><span class="pre">xyxymatch</span></code> for use in matching the object lists from each
image with the reference image’s object list.</p>
</dd>
<dt><strong>separation</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = 0.0)</span></dt>
<dd><p class="first last">The  minimum  separation for objects in the input and reference
coordinate lists. Objects closer together than ‘separation’ pixels
are removed from the input and reference coordinate lists prior
to matching. This parameter gets passed directly to <code class="xref py py-obj docutils literal notranslate"><span class="pre">xyxymatch</span></code> for
use in matching the object lists from each image with the reference
image’s object list.</p>
</dd>
<dt><strong>xoffset</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = 0.0)</span></dt>
<dd><p class="first last">Initial estimate for the offset in X between the images and the
reference frame. This offset will be used for all input images
provided. If the parameter value is set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, no offset will
be assumed in matching sources in <code class="xref py py-obj docutils literal notranslate"><span class="pre">xyxymatch</span></code>.</p>
</dd>
<dt><strong>yoffset</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = 0.0)</span></dt>
<dd><p class="first last">Initial estimate for the offset in Y between the images and the
reference frame. This offset will be used for all input images
provided.If the parameter value is set to None, no offset will
be assumed in matching sources in <code class="xref py py-obj docutils literal notranslate"><span class="pre">xyxymatch</span></code>.</p>
</dd>
<dt><strong>*CATALOG FITTING PARAMETERS*</strong></dt>
<dd></dd>
<dt><strong>fitgeometry</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str {‘shift’, ‘rscale’, ‘general’} (Default = ‘rscale’)</span></dt>
<dd><p class="first last">The fitting geometry to be used in fitting the matched object lists.
This parameter is used in fitting the offsets, rotations and/or scale
changes from the matched object lists. The ‘general’ fit geometry
allows for independent scale and rotation for each axis.</p>
</dd>
<dt><strong>residplot</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str {‘No plot’, ‘vector’, ‘residuals’, ‘both’}  (Default = ‘both’)</span></dt>
<dd><p class="first last">Plot residuals from fit? If ‘both’ is selected, the ‘vector’
and ‘residuals’ plots will be displayed in separate plotting windows at
the same time.</p>
</dd>
<dt><strong>nclip</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = 3)</span></dt>
<dd><p class="first last">Number of clipping iterations in fit.</p>
</dd>
<dt><strong>sigma</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = 3.0)</span></dt>
<dd><p class="first last">Clipping limit in sigma units.</p>
</dd>
<dt><strong>*ADVANCED PARAMETERS AVAILABLE FROM COMMAND LINE*</strong></dt>
<dd></dd>
<dt><strong>updatewcs</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool  (Default = No)</span></dt>
<dd><p class="first">This parameter specifies whether the WCS keywords are to be updated by
running updatewcs on the input data, or left alone. The update performed
by updatewcs not only recomputes the WCS based on the currently
used <code class="docutils literal notranslate"><span class="pre">IDCTAB</span></code>, but also populates the header with
the <code class="docutils literal notranslate"><span class="pre">SIP</span></code> coefficients. For <code class="docutils literal notranslate"><span class="pre">ACS/WFC</span></code> images, the time-dependence
correction will also be applied to the <code class="docutils literal notranslate"><span class="pre">WCS</span></code> and <code class="docutils literal notranslate"><span class="pre">SIP</span></code> keywords.
This parameter should be set to ‘No’ (<a class="reference external" href="https://docs.python.org/2/library/constants.html#False" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>) when the WCS keywords
have been carefully set by some other method, and need to be passed
through to drizzle ‘as is’, otherwise those updates will be over-written
by this update.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This parameter was preserved in the API for compatibility purposes with
existing user processing pipe-lines. However, it has been removed from the
TEAL interface because it is easy to have it set to ‘yes’
(especially between consecutive runs of <code class="xref py py-obj docutils literal notranslate"><span class="pre">AstroDrizzle</span></code>) with potentially
disastrous effects on input image WCS (for example it could wipe-out
previously aligned WCS).</p>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><code class="xref py py-obj docutils literal notranslate"><span class="pre">astrodrizzle</span></code></p>
</div>
<p class="rubric">Notes</p>
<p>Tweakreg supports the use of calibrated, distorted images (such as FLT
images for ACS and WFC3, or <code class="docutils literal notranslate"><span class="pre">_c0m.fits</span></code> images for WFPC2) as input images.
All coordinates for sources derived from these images (either by this task
or as provided by the user directly) will be corrected for distortion using
the distortion model information specified in each image’s header. This
eliminates the need to run ‘astrodrizzle’ on the input images prior to
running <code class="xref py py-obj docutils literal notranslate"><span class="pre">tweakreg</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All calibrated input images must have been updated using
<code class="xref py py-obj docutils literal notranslate"><span class="pre">updatewcs</span></code> from the <code class="xref py py-obj docutils literal notranslate"><span class="pre">STWCS</span></code> package, to include the full
distortion model in the header. Alternatively, one can set
<code class="xref py py-obj docutils literal notranslate"><span class="pre">updatewcs</span></code> parameter to <a class="reference external" href="https://docs.python.org/2/library/constants.html#True" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a> when running either <a class="reference internal" href="#drizzlepac.tweakreg.TweakReg" title="drizzlepac.tweakreg.TweakReg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TweakReg</span></code></a>
or <code class="xref py py-obj docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> from command line (Python interpreter)
<strong>the first time</strong> on such images.</p>
</div>
<p>This task will use catalogs, and catalog-matching, based on the <code class="xref py py-obj docutils literal notranslate"><span class="pre">xyxymatch</span></code>
algorithm to determine the offset between the input images. The primary
mode of operation will be to extract a catalog of source positions from
each input image using either a ‘DAOFIND-like’ algorithm or <code class="docutils literal notranslate"><span class="pre">SExtractor</span></code> (if
the user has <code class="docutils literal notranslate"><span class="pre">SExtractor</span></code> installed). Alternatively, the user can provide
their catalogs of source positions derived from <strong>each input chip</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Catalog files must be text files containing
“white space”-separated list of values (<code class="docutils literal notranslate"><span class="pre">xcol</span></code>, <code class="docutils literal notranslate"><span class="pre">ycol</span></code>, etc.)</p>
</div>
<p>The reference frame will be defined either by:</p>
<blockquote>
<div><ul class="simple">
<li>the image with the largest overlap with another input image AND
with the largest total overlap with the rest of the input images,</li>
<li>a catalog derived from a reference image specified by the user, or</li>
<li>a catalog of undistorted sky positions (RA/Dec) and fluxes
provided by the user.</li>
</ul>
</div></blockquote>
<p>For a given observation, the distortion model is applied to all distorted
input positions, and the sources from each chip are then combined into a
single catalog of undistorted positions.</p>
<p>The undistorted positions for each observation then get passed to
<code class="xref py py-obj docutils literal notranslate"><span class="pre">xyxymatch</span></code> for matching to objects from the reference catalog.</p>
<p>The source lists from each image will generally include cosmic-rays as
detected sources, which can at times significantly confuse object
identification between images. Observations that include long exposures
often have more cosmic-ray events than source objects. As such, isolating
the cosmic-ray events in those cases would significantly improve the
efficiency of common source identification between images. One such method
for trimming potential false detections from each source list would be
to set a flux limit to exclude detections below that limit. As the fluxes
reported in the default source object lists are provided as magnitude
values, setting the <code class="xref py py-obj docutils literal notranslate"><span class="pre">maxflux</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">minflux</span></code> parameter value to a magnitude-
based limit, and then setting the <code class="xref py py-obj docutils literal notranslate"><span class="pre">ascend</span></code> parameter to <a class="reference external" href="https://docs.python.org/2/library/constants.html#True" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, will allow
for the creations of catalogs trimmed of all sources fainter than the
provided limit. The trimmed source list can then be used in matching
sources between images and in establishing the final fitting for the shifts.</p>
<p>A fit can then be performed on the matched set of positions between the
input and the reference to produce the ‘shiftfile’. If the user is
confident that the solution will be correct, the header of each input image
can be updated directly with the fit derived for that image. Otherwise,
the ‘shiftfile’ can be passed to AstroDrizzle for aligning the images.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because of the nature of the used algorithm it may be necessary
to run this task multiple time until new shifts, rotations,
and/or scales are small enough for the required precision.</p>
</div>
<p>New sources (that are not in the reference catalog) from the matched images
are added to the reference catalog in order to allow next image to be
matched to a larger reference catalog. This allows alignment of images
that do not overlap directly with the reference image and/or catalog and
it is particularly useful in image registration of large mosaics. Addition
of new sources to the reference catalog can be turned off by
setting <code class="xref py py-obj docutils literal notranslate"><span class="pre">expand_refcat</span></code> to <a class="reference external" href="https://docs.python.org/2/library/constants.html#False" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a> when using an external reference catalog.
When an external catalog is not provided (<code class="xref py py-obj docutils literal notranslate"><span class="pre">refcat`='')</span> <span class="pre">or</span> <span class="pre">when</span>
<span class="pre">using</span> <span class="pre">an</span> <span class="pre">external</span> <span class="pre">reference</span> <span class="pre">catalog</span> <span class="pre">with</span> <span class="pre">`expand_refcat</span></code> set to <a class="reference external" href="https://docs.python.org/2/library/constants.html#True" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>
(assuming <code class="xref py py-obj docutils literal notranslate"><span class="pre">writecat</span></code> = <a class="reference external" href="https://docs.python.org/2/library/constants.html#True" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">clean</span></code> = <a class="reference external" href="https://docs.python.org/2/library/constants.html#False" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>),
the list of all sources in the expanded reference catalog is saved
in a catalog file named <code class="docutils literal notranslate"><span class="pre">cumulative_sky_refcat_###.coo</span></code> where ### is the
base file name derived from either the external catalog (if provided) or
the name of the image used as the reference image.</p>
<p>When <code class="xref py py-obj docutils literal notranslate"><span class="pre">enforce_user_order</span></code> is <a class="reference external" href="https://docs.python.org/2/library/constants.html#False" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>, image catalogs are matched to the
reference catalog in order of decreasing overlap area with the reference
catalog, otherwise user order of files specified in the <a class="reference external" href="https://docs.python.org/2/library/functions.html#file" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">file</span></code></a> parameter
is used.</p>
<p><strong>Format of Exclusion Catalog</strong></p>
<p>The format for the exclusions catalog requires 1 line in the file for
every input image, regardless of whether or not that image has
any defined exclusion regions.  A sample file would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">j99da1emq_flt</span><span class="o">.</span><span class="n">fits</span>
<span class="n">j99da1f2q_flt</span><span class="o">.</span><span class="n">fits</span> <span class="n">test_exclusion</span><span class="o">.</span><span class="n">reg</span>
</pre></div>
</div>
<p>This file specifies no exclusion files for the first image, and only
an regions file for SCI,1 of the second image.  NOTE: The first file can be
dropped completely from the exclusion catalog file.</p>
<p>In the above example, should an exclusion regions file only be needed for the
second chip in the second image, the file would need to look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">j99da1emq_flt</span><span class="o">.</span><span class="n">fits</span>
<span class="n">j99da1f2q_flt</span><span class="o">.</span><span class="n">fits</span> <span class="kc">None</span> <span class="n">test_sci2_exclusion</span><span class="o">.</span><span class="n">reg</span>
</pre></div>
</div>
<p>The value <a class="reference external" href="https://docs.python.org/2/library/constants.html#None" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> could also be replaced by <code class="docutils literal notranslate"><span class="pre">INDEF</span></code> if desired, but either
string needs to be present to signify no regions file for that chip while
the code continues parsing the line to find a file for the second chip.</p>
<p><strong>Format of Region Files</strong></p>
<p>The format of the exclusions catalogs referenced in the ‘exclusions’
file defaults to the format written out by DS9 using the ‘DS9/Funtools’
region file format.  A sample file with circle() regions will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Region file format: DS9 version 4.1</span>
<span class="c1"># Filename: j99da1f2q_flt.fits[SCI]</span>
<span class="k">global</span> <span class="n">color</span><span class="o">=</span><span class="n">green</span> <span class="n">dashlist</span><span class="o">=</span><span class="mi">8</span> <span class="mi">3</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;helvetica 10 normal roman&quot;</span>
<span class="n">select</span><span class="o">=</span><span class="mi">1</span> <span class="n">highlite</span><span class="o">=</span><span class="mi">1</span> <span class="n">dash</span><span class="o">=</span><span class="mi">0</span> <span class="n">fixed</span><span class="o">=</span><span class="mi">0</span> <span class="n">edit</span><span class="o">=</span><span class="mi">1</span> <span class="n">move</span><span class="o">=</span><span class="mi">1</span> <span class="n">delete</span><span class="o">=</span><span class="mi">1</span> <span class="n">include</span><span class="o">=</span><span class="mi">1</span> <span class="n">source</span><span class="o">=</span><span class="mi">1</span>
<span class="n">image</span>
<span class="n">circle</span><span class="p">(</span><span class="mi">3170</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ellipse</span><span class="p">(</span><span class="mi">3269</span><span class="p">,</span><span class="mi">428</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span> <span class="c1"># a rotated ellipse</span>
<span class="n">box</span><span class="p">(</span><span class="mf">3241.1146</span><span class="p">,</span><span class="mf">219.78132</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="c1"># a rotated box</span>
<span class="n">circle</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>  <span class="c1"># outer circle</span>
<span class="o">-</span><span class="n">circle</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span> <span class="c1"># inner circle</span>
</pre></div>
</div>
<p>This region file will be interpreted as “find all sources in the image that
<strong>are inside</strong> the four regions above but <strong>not inside</strong> the
region -circle(200,200,30)”. Effectively we will instruct <a class="reference internal" href="#drizzlepac.tweakreg.TweakReg" title="drizzlepac.tweakreg.TweakReg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TweakReg</span></code></a>
to find all the sources <em>inside</em> the following regions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">circle</span><span class="p">(</span><span class="mi">3170</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ellipse</span><span class="p">(</span><span class="mi">3269</span><span class="p">,</span><span class="mi">428</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span> <span class="c1"># a rotated ellipse</span>
<span class="n">box</span><span class="p">(</span><span class="mf">3241.1146</span><span class="p">,</span><span class="mf">219.78132</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="c1"># a rotated box</span>
<span class="n">annulus</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>  <span class="c1"># outer circle(r=50) - inner circle(r=30)</span>
</pre></div>
</div>
<p class="rubric">Examples</p>
<p>The tweakreg task can be run from either the TEAL GUI or from the command-line
using PyRAF or Python.
These examples illustrate the various syntax options available.</p>
<p><strong>Example 1:</strong>  Align a set of calibrated (<code class="docutils literal notranslate"><span class="pre">_flt.fits</span></code>) images
using <code class="docutils literal notranslate"><span class="pre">IMAGEFIND</span></code>, a built-in source
finding algorithm based on <code class="docutils literal notranslate"><span class="pre">DAOPHOT</span></code>. Auto-detect the sky sigma value and select sources &gt; 200
sigma.   (Auto-sigma is computed from the first input exposure
as:  <code class="docutils literal notranslate"><span class="pre">1.5*imstat(image,nclip=3,fields='stddev')</span></code>. )
Set the convolution kernel width to <code class="docutils literal notranslate"><span class="pre">~2x</span></code> the value of the PSF FWHM.
Save the residual offsets (<code class="docutils literal notranslate"><span class="pre">dx</span></code>, <code class="docutils literal notranslate"><span class="pre">dy</span></code>, <code class="docutils literal notranslate"><span class="pre">rot</span></code>, <code class="docutils literal notranslate"><span class="pre">scale</span></code>, <code class="docutils literal notranslate"><span class="pre">xfit_rms</span></code>, <code class="docutils literal notranslate"><span class="pre">yfit_rms</span></code>) to a text file.</p>
<ol class="arabic">
<li><p class="first">Run the task from PyRAF using the TEAL GUI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">drizzlepac</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">epar</span> <span class="n">tweakreg</span>
</pre></div>
</div>
</li>
<li><p class="first">Run the task from PyRAF using the command line while individually
specifying source finding parameters for the reference image and
input images:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">drizzlepac</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">drizzlepac</span> <span class="k">import</span> <span class="n">tweakreg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">,</span>
<span class="gp">... </span>      <span class="n">imagefindcfg</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;threshold&#39;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;conv_width&#39;</span> <span class="p">:</span> <span class="mf">3.5</span><span class="p">},</span>
<span class="gp">... </span>      <span class="n">refimagefindcfg</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;threshold&#39;</span> <span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;conv_width&#39;</span> <span class="p">:</span> <span class="mf">2.5</span><span class="p">},</span>
<span class="gp">... </span>      <span class="n">updatehdr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shiftfile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outshifts</span><span class="o">=</span><span class="s1">&#39;shift.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or, using <a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> constructor,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">drizzlepac</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">drizzlepac</span> <span class="k">import</span> <span class="n">tweakreg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">,</span>
<span class="gp">... </span>      <span class="n">imagefindcfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">conv_width</span><span class="o">=</span><span class="mf">3.5</span><span class="p">),</span>
<span class="gp">... </span>      <span class="n">refimagefindcfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">conv_width</span><span class="o">=</span><span class="mf">2.5</span><span class="p">),</span>
<span class="gp">... </span>      <span class="n">updatehdr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shiftfile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outshifts</span><span class="o">=</span><span class="s1">&#39;shift.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or, run the same task from the PyRAF command line, but specify all parameters in
a config file named “myparam.cfg”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;*flt.fits&#39;</span><span class="p">,</span> <span class="n">configobj</span><span class="o">=</span><span class="s1">&#39;myparam.cfg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternately, edit the imagefind parameters in a TEAL GUI window
prior to running the task:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tweakreg</span><span class="o">.</span><span class="n">edit_imagefindpars</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">Help can be accessed via the “Help” pulldown menu in the TEAL GUI.  It can also
be accessed from the PyRAF command-line and saved to a text file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">drizzlepac</span> <span class="k">import</span> <span class="n">tweakreg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tweakreg</span><span class="o">.</span><span class="n">help</span><span class="p">()</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tweakreg</span><span class="o">.</span><span class="n">help</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;help.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">page</span> <span class="n">help</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="drizzlepac.tweakreg.help">
<code class="descclassname">drizzlepac.tweakreg.</code><code class="descname">help</code><span class="sig-paren">(</span><em>file=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/drizzlepac/tweakreg.html#help"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#drizzlepac.tweakreg.help" title="Permalink to this definition">¶</a></dt>
<dd><p>Print out syntax help for running astrodrizzle</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>file</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = None)</span></dt>
<dd><p class="first last">If given, write out help to the filename specified by this parameter
Any previously existing file with this name will be deleted before
writing out the help.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="refimagefindpars.html" class="btn btn-neutral float-right" title="Refmagefindpars: Source finding parameters for the reference image" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="CHANGELOG.html" class="btn btn-neutral" title="DrizzlePac Release Notes" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Warren Hack, Nadia Dencheva, Chris Sontag, Megan Sosey, Michael Droettboom, Mihai Cara.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.2.6 (2018-11-02 15:37:13 -0400)',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>