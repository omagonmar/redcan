.help nfflt2pin Mar2005 gemini.gnirs
.ih
NAME
.nf
nfflt2pin -- Generate a synthetic pinhole trace from a flat field
.fi
.ih
USAGE
nfflt2pin inimage
.ih
PARAMETERS
.ls inimage
The input data, typically a flat, used to generate the "pinhole".
The science extension (NSHEADERS.\fIsci_ext\fR) is used for the
template data; the dispersion axis is read from the primary header
(see \fIdispaxis\fR).
.le
.ls outimage = ""
The name of the image to generate, using the algorithm described below.
.le
.ls outprefix = "p"
The prefix used to generate output image names from the input image
\fIinimage\fR if \fIoutimage\fR="".
.le
.ls threshold = "[*,*]"
Either a section, used with \fIscale\fR to calculate the threshold,
or a direct threshold value.
.le
.ls scale = 0.05
If \fIthreshold\fR describes a section then the midpoint and sigma
for that section are calculated.  Points in that section that deviate
more than 5 sigma from the midpoint are discarded and the statistics
calculated again.  This gives a robust midpoint and sigma, which are
used with \fIscale\fR to calculate the threshold.

If \fIscale\fR is positive, the threshold is the product of the
midpoint and \fIscale\fR.  This is suitable for finding a fractional
level after measuring count levels in the input image.

Otherwise, the threshold is the midpoint plus the sigma scaled by the
absolute value of the \fIscale\fR.  This is suitable for finding a
level above the noise after measuring a dark region in the input image.
.le
.ls dispaxis = INDEF
The dispersion axis, if none available in the header of \fIinimage\fR.
.le
.ls logfile = ""
Name of logfile.  The GNIRS package logfile "gnirs.log" is used by default.
.le
.ls verbose = yes
Print more actions to the screen.
.le
.ls status = 0
Exit status will be non-zero if the procedure halted with an error.
This parameter is always set by the task, and should not be modified
by the user.
.le
.sp
.ce
Parameters from NSHEADERS
.sp
The following values are read from GNIRS.NSHEADERS
.ls sci_ext
Name of science extension
.le
.ls key_dispaxis
Header keyword for dispersion axis
.le
.ih
DESCRIPTION
This task generates a synthetic "pinhole" spectrum from a flat field
observation.  It is intended for use with IFU data, so that spatial
distortion can be measured with NSSDIST and corrected with NSTRANSFORM.
When used in this way, a flat field image, already processed by
NSPREPARE should be given as input.  The input data should be uncut
and the output data should be processed by NSCUT before calling
NSSDIST.
.sp
A synthetic pinhole is generated by replacing the illumination in the 
flat field observations with "peaks" (one for each image slice). 
Regions of illumination are identified by comparing the level with a
threshold (see the parameters \fIthreshold\fR and \fIscale\fR) above.
.sp
Each spatial line in the input data is scanned in turn, and areas of
illumination identified.  The output image is zero outside these areas.
Inside the illumination, the output is the distance to the edge of the
local illuminated region, squared.
.sp
For example, see the sketch below.  The first row shows values
from a line in \fIinimage\fR.  The threshold value is 3.  The next
line shows whether each pixel (value) is above the threshold.  Below
that is the distance from the edge of the illumination and, finally,
the output values.
.sp
.nf
  Data     0  1  -1  5  6  4  4 -1 -2  2  9  8  7 
  Above?   n  n   n  y  y  y  y  n  n  n  y  y  y
  Distance -  -   -  1  2  2  1  -  -  -  1  2  1
  Result   0  0   0  1  4  4  1  0  0  0  1  4  1
.fi
.ih
EXAMPLE
1.  The basic usage is
.sp
.nf
  cl> nfflt2pin nS20041120S0181 outimage=pinhole
.fi
.ih
TIMING
A compiled task (PEAKHELPER) is used for the basic image transformation,
so this task should run "quickly".
.ih
BUGS AND LIMITATIONS
.ih
SEE ALSO
nssdist, nstransform, peakhelper
.endhelp
