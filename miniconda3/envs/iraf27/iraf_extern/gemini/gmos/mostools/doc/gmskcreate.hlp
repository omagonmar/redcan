.help gmskcreate May2017 gemini.gmos.mostools
.ih
NAME
gmskcreate -- Create required mask-making files from non-Gemini images
.ih
USAGE
gmskcreate indata gprgid instrument rafield decfield pa
.ih
PARAMETERS
.ls indata
File containing information for spectroscopy candidates and/or objects to use 
to create pseudo-Gemini image.
.le
.ls gprgid
Gemini program ID.
.le
.ls instrument [gmos-n|gmos-s|flamingos2]
Gemini Instrument the input image is to be transformed into. The coordinate 
transformations are different for each instrument. Lower-case values are valid.
.le
.ls rafield
Right ascension of field centre required for the multi-object spectroscopy 
observations.  In hours or degrees, see parameter \fIfraunits\fR.
.le
.ls decfield
Declination of field centre required for the multi-object spectroscopy 
observations.  In degrees.
.le
.ls pa
Position angle required for the multi-object spectroscopy observations. This is 
the same angle as used to define the observations in the Observing Tool.
.le
.ls fl_getim = yes
Create a pseudo-Gemini image (\fIoutimage\fR) from \fIinimage\fR.
.le
.ls inimage = ""
Image to be transformed (if MEF, specify extension) into a pseudo-Gemini image
(\fIoutimage\fR), if \fIfl_getim\fR=yes
.le
.ls outimage = ""
Name for output pseudo-Gemini image, if \fIfl_getim\fR=yes
.le
.ls fl_getxy = yes
Create the files containing x,y (\fIoutcoords\fR) and GMMPS object table
(\fIouttab\fR).  
.le
.ls outcoords = ""
Output file for x,y, if \fIfl_getxy\fR=yes.  If left empty, the file name 
will be built by prepending 'GMI' to \fIincoords\fR.
.le
.ls outtab = ""
Output binary FITS table for GMMPS Object Table, if \fIfl_getxy\fR=yes.  If left
empty, the file name will be built by prepending 'GMI' to \fIincoords\fR.
.le
.ls iraunits = "hours"      [hours|degrees]
Units of the right ascension values in the input data file, \fIindata\fR.
.le
.ls fraunits = "hours"      [hours|degrees]
Units for \fIrafield\fR.
.le
.ls slitszx = 1.0
Default slit width in arcsecs (In a F2 mask, the width becomes slitsize_y)
.le
.ls slitszy = 5.0
Default slit length in arcsecs (In a F2 mask, the length becomes slitsize_x)
.le
.ls logfile = ""
Name of the logfile.  If empty, the default value is taken from 
\fImostools.logfile\fR.
.le
.ls glogpars = ""
Logging preferences.
.le
.ls fl_inter = no
Toggle interactive mode for GEOMAP.  GEOMAP finds the transformation 
coefficients used to produce pseudo-Gemini image.
.le
.ls verbose = yes
Print actions to the screen.
.le
.ls fl_debug = no
Print debugging information.
.le
.ls status = 0
Exit status will be non-zero if the procedure halted with an error.  This
parameter is always set by the task, and should not be modified by the user.
.le
.ih
DESCRIPTION
.sp
GMSKCREATE creates the necessary files to design Gemini multi-object 
spectroscopy masks from non-Gemini images. The output files should be used in 
the Gemini mask making software, GMMPS, to create the masks.  The transform 
from RA and Dec to \fIinstrument\fR x,y positions is known for each GMOS 
(North and South). Though the option is available, Flamingos-2 support has not 
been added yet. GMSKCREATE uses this transform along with the user inputs -  
RA and Dec of the input objects, the required field centre and position angle - 
to calculate the x,y positions of the input objects in the instrument field. 
GMSKCREATE can also produce an output 'pseudo-Gemini' image, that can be used 
in GMMPS when creating the masks.
.sp
The pseudo-Gemini image allows a useful check during mask creation with GMMPS 
that the slits are in the expected place and must be submitted to the 
observatory for mask checking. 

However all the objects need not be seen in
the input image


it is not necessary that it is of good 
enough quality to show the all input objects; for example, DSS images are OK. 
The transform from input image to pseudo-Gemini image is found by generating a 
RA-Dec object grid that mimics a real input list of objects, but has the 
advantage of being evenly spaced over the final transformed image in order to 
give a better fit for the transformation. The grid is generated by placing 8 
objects around the field center (thus creating a 9 point grid) in 3 concentric 
squares with a distribution to give even coverage over the intended 
\fIinstrument\fR field of view. The object grid is transformed by GMSKXY to 
instrument x-y position and also using the world coordinate system(WCS) of the 
input image to generate the second set of x-y positions. This requires that the 
input image contains the WCS keywords CRPIX1, CRPIX2, CRVAL1, CRVAL2, CD1_1, 
CD1_2, CD2_1 and CD2_2. For DSS images these keywords can be added with the 
command MAKEWCS. If the WCS of the input image and the astrometry of the input
objects are not consistent, a mismatch between slit and object positions may 
result. Because the x,y positions are taken from the Object Table and not
from the image, this will not generate problems for mask creation. However, such
an inconsistency may make it more difficult to check the mask. The 
transformation from RA and Dec to instrument x-y is not perfect, so the slits 
may be offset by a small amount when plotted over the transformed image. The 
better the astrometry of the input objects are, the better the results of the 
final mask will be.
.sp
The \fIindata\fR file should contain one object per line. Each line must 
contain values for 'id', 'ra', 'dec', 'mag', separated by spaces, where 'id' is 
an integer ID number for the object, 'ra' and 'dec' are the Right Ascension and 
Declination of the object, and 'mag' is the magnitude of the object.  The line 
for each object in the \fIindata\fR file can also optionally contain values for 
'priority', 'slitsize_x', 'slitsize_y', 'slittilt' and 'slitpos_y', again 
separated by spaces.  These values are used by (and can be altered in) GMMPS. 
'Priority' is an integer priority (0-3) for the object, 'slitsize_x' is the 
slit width (real) in arcsecs, 'slitsize_y' is the slit length (real) in 
arcsecs, 'slittilt' is the position angle of the slit in degrees measured 
counter-clockwise relative to zero degrees, and 'slitpos_y' is the slit 
position in the y-direction relative to the object position (real).  It is 
possible to set the optional values for just a few of the objects in the file. 
If only some of the optional values are set, they must be set in the order 
indicated or else the output object table will not match the values in the 
input table correctly. However, if only the first 2 optional parameters 
are used for example, the script will be able to add the rest of the values 
using the default values. If none of the optional values are set for an object 
then they will all be set to using the following default values - priority=1, 
slittilt=0, slitpos_y=0, and slitsize_x and slitsize_y as given in the input 
parameters \fIslitszx\fR and \fIslitszy\fR.
.sp
Other than the object data files, \fIindata\fR, the users must provide 
\fIgprgid\fR, their Gemini program ID (e.g GN-2007A-Q-4), the required RA,
\fIrafield\fR, and Dec, \fIdecfield\fR, of the instrument field centre and the 
position angle, \fIpa\fR of the instrument field. The field centre RA 
and Dec and the position angle *MUST BE THE SAME AS* the values used for the 
Phase II observation definition in the Observing Tool. Before creating the 
GMMPS files, users must check in the Observing Tool that there are suitable 
guide stars available given the required field centre and position angle. The 
field centre RA can be in hours or degrees. The units are given in 
\fIfraunits\fR.
.sp
If \fIfl_getim\fR = yes, then an input image, \fIinimage\fR must be given.  As 
described above, this image must have a valid WCS.
.sp
The RA of the input objects can be in hours or degrees. The units are given by 
\fIiraunits\fR.
.sp
If \fIfl_getxy\fR=yes the task produces two output files, \fIoutcoords\fR which 
contains the x,y coordinates in the \fIinstrument\fR field, one object per line,
and \fIouttab\fR which is the Object Table (FITS format) required as input for 
GMMPS. The \fIoutcoords\fR file is not required for GMMPS, but it may be useful 
to overplot the x,y positions on the pseudo-Gemini image using, for example, 
TVMARK.  The file \fIouttab\fR will be given the extension '.fits' if this is 
not already included in the name.  If \fIfl_getxy\fR=yes, but \fIoutcoords\fR 
or \fIouttab\fR are not set, then \fIoutcoords\fR is set to be \fIindata\fR 
with the prefix 'GMI' and \fIouttab\fR is set to be \fIindata\fR with the 
prefix 'GMI' and the extension '.fits'.
.sp
If \fIfl_getim\fR=yes the task produces the pseudo-Gemini image, \fIoutimage\fR.
The task will add the prefix 'GMI' to the \fIoutimage\fR parameter, as this is 
required to identify the images as pseudo-Gemini images when they are submitted 
using the Observing Tool. If \fIfl_getim\fR=yes and \fIoutimage\fR is not set, 
then it is set to be \fIinimage\fR with the prefix 'GMI'.
.ih
EXAMPLES
.sp
1. Create the files required for GMMPS using the default file names and values. 
It is assumed that the RA in 'fieldinfo' is given in hours.
.sp
.nf
    cl> gmskcreate fieldinfo GN-2007A-Q-01 gmos-n 6.1219397 \
    >>> 24.114456 180
.fi
.sp
2. Create the files required for GMMPS, with a slit width of 1.2 arcsec. The 
slit length is not set in the input parameters so the default value of 5 
arcsec will be used. If the slit width and slit length are set in the input 
file 'fieldinfo', then the values in this file will override the values set by 
the input parameters.  In this example, the output file names are specified by 
the user.  Here the RA in 'fieldinfo' are in degrees.
.sp
.nf
    cl> gmskcreate fieldinfo GN-2007A-Q-01 gmos-n 6.1219397 \
    >>> 24.114456 180 outcoords=field.xy outtab=field.cat \
    >>> iraunits=degrees slitszx=1.2 
.fi
.sp
3. Create the files required for GMMPS, and a pseudo-Gemini image.  The RA in 
'fieldinfo' are in degrees, and the slit size is set to 1.2 arcsec.
.sp
.nf
    cl> gmskcreate fieldinfo GN-2007A-Q-01 gmos-n 6.1219397 24.114456 \
    >>> 180 fl_getim+ inimage=DSS.fits iraunits=degrees slitszx=1.2
.fi
.sp
.ih
BUGS AND LIMITATIONS
None known.
.sp
Input field center of GMOS pseudo-image must be within field of view of input 
image.  RA/Dec of input coordinate file must be entered as a decimal and not 
sexagesimal format.  The Epoch and Equinox of input image WCS must match the 
input RA/Dec coordinates.
.ih
SEE ALSO
gmskxy, gmskimg
.endhelp
